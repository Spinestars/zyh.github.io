<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		k8s☞02安装 | 
	 
	zyh
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.google.com/search?q=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "zyh.cool";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@v1.4.14/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d8eaf4579517c8bea955331f62e2b380";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


<header id="header">
    <a id="title" href="/" class="logo">zyh</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">ABOUT</a>
		</li>
	
		<li class="menu-item">
			<a href="/tags" class="menu-item-link">标签</a>
		</li>
	

	
		<li class="menu-item">
			<a href="/categories" class="menu-item-link">分类</a>
		</li>
	
		<li class="menu-item">
			<a href="https://github.com/Spinestars" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="按回车全站搜索">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										web
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										fpm
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/b73a61bf/">
                     
										    fpm☞安装-包管理方式
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3321a2dc/">
                     
										    fpm☞安装-编译方式
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/d1d65c30/">
                     
										    fpm☞静态配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										nginx
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/58a1c0c7/">
                     
										    nginx☞fcgi中alias的使用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/4c513678/">
                     
										    nginx☞location
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/18de0eed/">
                     
										    nginx☞基本认证
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/6209085/">
                     
										    nginx☞安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/9fb0f3a1/">
                     
										    nginx☞日志切割
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/78ceb386/">
                     
										    nginx☞泛域名_变量截取
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/6332ca50/">
                     
										    nginx☞问题集
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										其它
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/7c44c2e8/">
                     
										    web☞服务器承载能力计算
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										公有云
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										aws
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/2e07203a/">
                     
										    aws☞EC2-GPU实例安装显卡驱动
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/438aa722/">
                     
										    aws☞rds-mysql参数
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/604c5952/">
                     
										    aws☞rds-mysql日志
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/2c5a64ff/">
                     
										    aws☞s3初始化创建
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/7cac5d21/">
                     
										    aws☞s3跨账户访问
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/ddc4c969/">
                     
										    aws☞利用cf服务初始化aws环境
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/2e304ad6/">
                     
										    aws☞国内外之间迁移-AMI
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										阿里云
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/6df9bb76/">
                     
										    aliyun☞cli安装和基本调用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/b5d7d6ee/">
                     
										    aliyun☞oss
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/4cc38acc/">
                     
										    aliyun☞常见问题
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										其它
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										git
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/a38d0013/">
                     
										    gitlab☞大版本迁移
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3f38f454/">
                     
										    gitlab☞安装及备份
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/5edc3545/">
                     
										    gitlab☞批量修改用户密码
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f0c6f6c3/">
                     
										    git☞常用命令
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										hexo
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/662e9d4d/">
                     
										    hexo☞图片显示404错误的解决办法
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f5c218d/">
                     
										    hexo☞本地搜索
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/7c1abbe1/">
                     
										    openvpn☞安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/894f9595/">
                     
										    vsftpd☞安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3827a60a/">
                     
										    工具库
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/40d986c3/">
                     
										    网络-SNAT和DNAT
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/5290b79d/">
                     
										    网络☞S5700配置攻击朔源
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/6f53a6b8/">
                     
										    网络☞链路聚合
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/1ddb9d4e/">
                     
										    问题记录
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										容器
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										docker
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/634b48fb/">
                     
										    docker-常用的指令
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/b7cf7b1f/">
                     
										    docker☞01安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/604e367f/">
                     
										    docker☞非root用户执行程序
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										harbor
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/9573a87d/">
                     
										    harbor☞安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										helm
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/51015304/">
                     
										    helm☞01入门
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/710e3e49/">
                     
										    helm☞02chart
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										k8s
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/aaf9b7/">
                     
										    k8s☞01常见术语概念
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/c3c9f0f8/">
                     
										    k8s☞02-1切换使用runtime-containerd
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/posts/9602dad/">
                     
										    k8s☞02安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/94518966/">
                     
										    k8s☞03Pod
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3ec72f7e/">
                     
										    k8s☞04Pod-init容器
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/9aa66899/">
                     
										    k8s☞05容器生命周期-回调和探针
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/18e4fa73/">
                     
										    k8s☞06无状态服务deployment
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f6e328b5/">
                     
										    k8s☞07自动扩缩
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/d3b80b5f/">
                     
										    k8s☞08负载均衡service
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/1080c6b6/">
                     
										    k8s☞09存储资源
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/4b0e4a5/">
                     
										    k8s☞10应用配置与密码与信息提供
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/64fa9c84/">
                     
										    k8s☞11-1pod资源约束
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/ed4c29d5/">
                     
										    k8s☞11-2namespace资源约束
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/63d8d3d4/">
                     
										    k8s☞12-1DaemonSet
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/4bf29cf0/">
                     
										    k8s☞12-2有状态服务StatefulSet
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/7627a41d/">
                     
										    k8s☞13高级版负载均衡ingress控制器
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/a5ed67a6/">
                     
										    k8s☞14认证授权
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/55da993d/">
                     
										    k8s☞15证书管理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/7538d100/">
                     
										    k8s☞16kubeadm集群升级
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/932d1f08/">
                     
										    k8s☞17-1调度之node污染和pod容忍
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/4d69fc4a/">
                     
										    k8s☞17-2调度之亲和性和反亲和性
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/451721ed/">
                     
										    k8s☞18日志收集系统
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/ce23a4a1/">
                     
										    k8s☞19日志系统EFK
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/68c615a7/">
                     
										    k8s☞20网络cni
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/e902d670/">
                     
										    k8s☞21证书管理器
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/c15432fa/">
                     
										    k8s☞kubectl多集群管理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/9a7bc037/">
                     
										    k8s☞showdoc部署
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/e1096625/">
                     
										    k8s☞记录点
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										数据库
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										mysql
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/b824edd8/">
                     
										    mysql☞安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/e6ae9474/">
                     
										    mysql☞常用命令
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/c83ca575/">
                     
										    mysql☞离线迁移脚本
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										pgsql
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/684ab210/">
                     
										    pgsql-基础命令
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										redis
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/2c2d50a0/">
                     
										    redis☞备份
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/65ab632a/">
                     
										    redis☞安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/28361833/">
                     
										    redis☞获取没有设置ttl的key
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/28361833/">
                     
										    redis☞调整内核参数
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										日志
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										ELK
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/f8ca35d2/">
                     
										    日志☞00ELK基本使用-简介
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3475106c/">
                     
										    日志☞01ELK基本使用-beats组件
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f73d84da/">
                     
										    日志☞02ELK基本使用-logstash组件01-安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/56da51f2/">
                     
										    日志☞03ELK基本使用-logstash组件02-插件介绍
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/41bf4066/">
                     
										    日志☞04ELK基本使用-elasticsearch
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/d8390732/">
                     
										    日志☞05ELK基本使用-kibana
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										其它
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/421d605e/">
                     
										    日志☞logrotate安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										消息
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										kafka
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/9bd7430f/">
                     
										    001-kafka基本信息
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/bd4c8d1c/">
                     
										    002-kafka基本安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/2fb0e26c/">
                     
										    003-kafka基本认证
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/14fdb3fd/">
                     
										    004-kafka用户配额
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/124a3d6d/">
                     
										    005-kafka基本维护
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/1a545f72/">
                     
										    006-kafka基本监控
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/41d19ce/">
                     
										    007-kafka基本保活
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										rabbitmq
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/b43013ef/">
                     
										    rabbitmq☞安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										监控
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										prometheus
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/65820315/">
                     
										    prometheus☞01搭建
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/e172b6e2/">
                     
										    prometheus☞02外置prometheus监控k8s
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/bced4977/">
                     
										    prometheus☞03k8s内置部署
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/978d0c1d/">
                     
										    prometheus☞04redis监控
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/6178b477/">
                     
										    prometheus☞05mysql监控
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/7fd13722/">
                     
										    prometheus☞06rabbitmq监控
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										zabbix
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/3d20f83e/">
                     
										    zabbix☞WEB监控
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/1587f6e8/">
                     
										    zabbix☞agent和proxy(yum)
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/b35b5965/">
                     
										    zabbix☞nginx
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/6c093771/">
                     
										    zabbix☞redis
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/ed865d2f/">
                     
										    zabbix☞server安装注意事项
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/25f36846/">
                     
										    zabbix☞容器搭建
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/4ebbd3a8/">
                     
										    zabbix☞预警
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										其它
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/ae41ae33/">
                     
										    监控☞monit
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/ab1247fb/">
                     
										    监控☞mysql慢sql预警
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/8c33f887/">
                     
										    监控☞企业微信机器人
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f9b08c30/">
                     
										    监控☞微信预警
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/1fac36d/">
                     
										    监控☞远程磁盘检测
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f8f9b4d0/">
                     
										    监控☞邮件预警
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										系统
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										linux
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/c3b69c28/">
                     
										    linux-添加ssh登陆限制
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/13364d65/">
                     
										    linux☞centos7重置root密码
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/a3dfc0e8/">
                     
										    linux☞df与du数据不一致的原因
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/5db0cd07/">
                     
										    linux☞ssh-MFA自动登陆
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/e4f7ce4c/">
                     
										    linux☞ubuntu20-04纯命令行网卡配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/7b3cf3d8/">
                     
										    linux☞使用expect自动登录ssh后远程会话不会跟随本地会话缩放的问题
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/d2fed0bf/">
                     
										    linux☞利用acme-sh管理免费的ssl证书申请
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/cd32aa48/">
                     
										    linux☞时间
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f41d0763/">
                     
										    linux☞系统内核优化
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/a7611bc1/">
                     
										    linux☞软raid创建
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3988a5f2/">
                     
										    linux☞输出个性化开机状态
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										windows
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/348cba53/">
                     
										    windows-wsl问题点
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/22b82d75/">
                     
										    windows-包管理工具-scoop
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/88eb7b6/">
                     
										    windows☞win10迁移数据
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										自动化
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										ansible
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/15aa7d2e/">
                     
										    ansible☞playbook-aws
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/b0929188/">
                     
										    ansible☞playbook-handle
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/6ce01f58/">
                     
										    ansible☞playbook-include
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/25732c33/">
                     
										    ansible☞playbook-lookup插件
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/960fc783/">
                     
										    ansible☞playbook-tags
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/4235ddf4/">
                     
										    ansible☞playbook-变量
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/14bc184e/">
                     
										    ansible☞playbook-循环
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/29683589/">
                     
										    ansible☞playbook-条件判断
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f43dca37/">
                     
										    ansible☞playbook-过滤器
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/c4126d5a/">
                     
										    ansible☞playbook-错误捕获
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/d3e413b7/">
                     
										    ansible☞基础信息
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/1e274151/">
                     
										    ansible☞常用模块-命令调用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/4235ddf4/">
                     
										    ansible☞常用模块-文本文件操作
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/84eb900/">
                     
										    ansible☞常用模块-系统相关
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3d9b9ec1/">
                     
										    ansible☞常用模块-软件包管理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/724fda19/">
                     
										    ansible☞模板
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/720afd15/">
                     
										    ansible☞角色
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										jenkins
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/d9cdb70/">
                     
										    jenkins☞001安装和基本配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/8a33e212/">
                     
										    jenkins☞002Pipelines
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/e4df8a4f/">
                     
										    jenkins☞003共享库
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3e0f2183/">
                     
										    jenkins☞从容器中访问宿主机docker命令
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3b5cd3e1/">
                     
										    jenkins☞动态agent
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										虚拟化
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										vmware
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/eab024cf/">
                     
										    vcsa☞存储设备有vmfs分区，但数据存储丢失
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										语言
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										css
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/fa5680b3/">
                     
										    css☞背景图居中拉伸平铺
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										go
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/38c126f9/">
                     
										    go-013文件先读再覆盖写
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/0/">
                     
										    go-014并发和管道
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/83a93e23/">
                     
										    go-015自定义包
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/5086e20/">
                     
										    go-016并发
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/786ba9af/">
                     
										    go-017测试
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/759b68d8/">
                     
										    go☞001变量
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/8c3e952e/">
                     
										    go☞002常量
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/1a034363/">
                     
										    go☞003运算符
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/8a6b5455/">
                     
										    go☞004控制流
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/98f86e16/">
                     
										    go☞005函数
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/318675c1/">
                     
										    go☞006函数-闭包
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/a705a91a/">
                     
										    go☞007结构
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/f8eb4b1b/">
                     
										    go☞008方法
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/77a46e91/">
                     
										    go☞009接口
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/2dab3d00/">
                     
										    go☞010特殊控制流(defer panic recover)
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/336ec0ac/">
                     
										    go☞011错误处理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/d1503f4a/">
                     
										    go☞012常用模块
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										java
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/ac6b3b36/">
                     
										    jdk☞安装和配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										jquery
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/5d527900/">
                     
										    jquery☞伪进度条
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										python
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/86059ffb/">
                     
										    django☞admin管理视图
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/dd4c9efa/">
                     
										    django☞restful简单使用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/26bd5165/">
                     
										    django☞日志
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/6a4df400/">
                     
										    django☞管理静态文件
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/3f8b5448/">
                     
										    django☞记忆点
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/d60c38c/">
                     
										    django☞验证码
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/876c5852/">
                     
										    python☞json
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										shell
									</a>
									
							<ul>
								<li class="file">
									<a href="/posts/241ce96c/">
                     
										    shell☞if判定
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/posts/b06f599c/">
                     
										    shell☞read嵌套
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">
	k8s☞02安装
</h1>
<div class="article-meta">
	
		<span>
			阅读量:<span id="/posts/9602dad/" class="leancloud_visitors" data-flag-title="k8s☞02安装"></span>
		</span>
	
	<span>zyh</span>
	<span>2020-08-25 17:17:44</span>
		<div id="article-categories">
    
		<span>Categories：</span>
            
                
                    <span>
                        <i class="fa fa-folder" aria-hidden="true">
                        <a href="/categories/容器/">容器</a>
                        </i>
                      
                        >
                      
                    </span>
                
            
                
                    <span>
                        <i class="fa fa-folder" aria-hidden="true">
                        <a href="/categories/容器/k8s/">k8s</a>
                        </i>
                      
                    </span>
                
            
    

    
		<span>Tags：</span>
            
                
                    <span>
                        <i class="fa fa-tag" aria-hidden="true">
                        <a href="/tags/容器/">容器</a>
                        </i>
                    </span>
                
            
                
                    <span>
                        <i class="fa fa-tag" aria-hidden="true">
                        <a href="/tags/k8s/">k8s</a>
                        </i>
                    </span>
                
            
    
		</div>

</div>

<div id="article-content">
	<h2 id="前言">前言</h2>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/">使用 kubeadm 引导集群 | Kubernetes</a></p>
<h2 id="结构">结构</h2>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/ha-topology/">高可用拓扑选项 | Kubernetes</a></p>
<p>我们选堆叠结构</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/d1411cded83856552f37911eb4522d9887ca4e83/b94b2/images/kubeadm/kubeadm-ha-topology-stacked-etcd.svg" alt="堆叠的 etcd 拓扑"></p>
<p>不过因为我环境里没有 LB 组件，因此选用 haproxy 来代替，又因为要为 haproxy 做高可用，因此为 haproxy 再外套一层 keepalived。</p>
<p>如果在阿里云构建，可以认为 LB 是健壮的。</p>
<h2 id="机器">机器</h2>
<p>机器系统都是 centos7,</p>
<p>三个节点，均为控制平面节点，同时也是Node节点，并利用 keepalived + haproxy 进行 <code>控制平面组件：apiserver</code> 高可用</p>
<table>
<thead>
<tr>
<th>hostname</th>
<th>ip</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td>k8sapi</td>
<td>10.200.16.100</td>
<td>keepalived vip</td>
</tr>
<tr>
<td>k8s01</td>
<td>10.200.16.101</td>
<td>master keepalived(主) haproxy</td>
</tr>
<tr>
<td>k8s02</td>
<td>10.200.16.102</td>
<td>master keepalived(备) haproxy</td>
</tr>
<tr>
<td>k8s03</td>
<td>10.200.16.103</td>
<td>master</td>
</tr>
</tbody>
</table>
<p>请务必确保内网可以通过表格里的 <code>hostname</code> 解析到对应的 <code>ip</code></p>
<p>请务必将系统的 hostname 改为上述表里的 hostname</p>
<p>数据走向：</p>
<p>client-&gt;keepalived(vip:8443)-&gt;haproxy(vip:8443)-&gt; all:6443</p>
<h2 id="所有节点">所有节点</h2>
<h3 id="时间同步">时间同步</h3>
<pre><code class="language-bash">yum install chrony -y
sed -i  '1a server cn.pool.ntp.org prefer iburst' /etc/chrony.conf
systemctl restart chronyd
systemctl enable chronyd
chronyc activity
</code></pre>
<h3 id="系统配置">系统配置</h3>
<pre><code class="language-bash"># 加载模块
modprobe overlay
modprobe br_netfilter
# 添加配置
cat &gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt;EOF
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF
# 配置生效
sysctl --system

# 清空防火墙
systemctl stop firewalld.service iptables.service
systemctl disable firewalld.service
systemctl disable iptables.service;
iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X

# 关闭selinux
setenforce 0
sed -i 's@^\(SELINUX=\).*@\1disabled@' /etc/sysconfig/selinux
sed -i 's@^\(SELINUX=\).*@\1disabled@' /etc/selinux/config

# 关闭 swap，kubelet 1.18 要求.如果你fstab也有，请一并注释
swapoff -a

# 安装 ipvs
yum install ipvsadm -y
ipvsadm --clear
cat&gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt; 'EOF'
ipvs_mods_dir=&quot;/usr/lib/modules/$(uname -r)/kernel/net/netfilter/ipvs&quot;
for i in $(ls $ipvs_mods_dir | grep -o &quot;^[^.]*&quot;); do
    /sbin/modinfo -F filename $i  &amp;&gt; /dev/null
    if [ $? -eq 0 ]; then
        /sbin/modprobe $i
    fi
done
EOF
chmod +x /etc/sysconfig/modules/ipvs.modules
/etc/sysconfig/modules/ipvs.modules
</code></pre>
<h3 id="安装容器">安装容器</h3>
<pre><code class="language-bash">yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2
yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
</code></pre>
<h4 id="选择版本">选择版本</h4>
<p>一定要选择所安装的 k8s 版本兼容的最新容器版本</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker">https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker</a></p>
</blockquote>
<pre><code class="language-bash">yum list docker-ce --showduplicates | sort -r
===
docker-ce.x86_64            3:20.10.7-3.el7                    docker-ce-stable
docker-ce.x86_64            3:20.10.6-3.el7                    docker-ce-stable
docker-ce.x86_64            3:20.10.5-3.el7                    docker-ce-stable
docker-ce.x86_64            3:20.10.4-3.el7                    docker-ce-stable
docker-ce.x86_64            3:20.10.3-3.el7                    docker-ce-stable
docker-ce.x86_64            3:20.10.2-3.el7                    docker-ce-stable
docker-ce.x86_64            3:20.10.1-3.el7                    docker-ce-stable
#################### 选择好所要安装的版本 ####################
docker_version=20.10.7  # 例如选择20.10.7
</code></pre>
<h4 id="安装并启动">安装并启动</h4>
<pre><code class="language-bash"># 安装兼容k8s的docker版本
yum install -y docker-ce-$&#123;docker_version&#125; docker-ce-cli-$&#123;docker_version&#125;
#sed -i '/ExecStart=/a ExecStartPort=/usr/sbin/iptables -P FORWARD ACCEPT' /usr/lib/systemd/system/docker.service;
mkdir -p /etc/docker;
cat &gt; /etc/docker/daemon.json &lt;&lt;EOF
&#123;
  &quot;data-root&quot;: &quot;/export/docker-data-root&quot;,
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],
  &quot;log-driver&quot;: &quot;json-file&quot;,
  &quot;log-opts&quot;: &#123;
    &quot;max-size&quot;: &quot;100m&quot;
  &#125;,
  &quot;storage-driver&quot;: &quot;overlay2&quot;,
  &quot;storage-opts&quot;: [
    &quot;overlay2.override_kernel_check=true&quot;
  ]
&#125;
EOF
systemctl daemon-reload
systemctl restart docker
systemctl enable docker
</code></pre>
<h3 id="安装-kubelet-kubeadm-kubectl">安装 kubelet kubeadm kubectl</h3>
<blockquote>
<p>阿里巴巴镜像点：</p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/kubernetes">https://developer.aliyun.com/mirror/kubernetes</a></p>
<p>google 官方安装文档 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p>
</blockquote>
<ol>
<li>google 官方源</li>
</ol>
<pre><code class="language-bash">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF
</code></pre>
<ol start="2">
<li>阿里源</li>
</ol>
<pre><code class="language-bash">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
</code></pre>
<ol start="3">
<li>安装</li>
</ol>
<pre><code class="language-bash"># 确定 kube* 版本
yum list kube* --showduplicates --disableexcludes=kubernetes
# 选择要安装的版本
full_verions=1.20.8-0
# 安装 kube 管理组件和 kubelet
yum install -y kubelet-$&#123;full_verions&#125; kubeadm-$&#123;full_verions&#125; kubectl-$&#123;full_verions&#125; --disableexcludes=kubernetes
systemctl enable --now kubelet
</code></pre>
<h2 id="高可用组件节点">高可用组件节点</h2>
<h3 id="安装负载均衡组件-haproxy-和-高可用组件-keepalived">安装负载均衡组件 haproxy 和 高可用组件 keepalived</h3>
<blockquote>
<p>k8s01，k8s02 执行</p>
</blockquote>
<ul>
<li>安装</li>
</ul>
<pre><code class="language-bash">yum install haproxy keepalived -y
</code></pre>
<ul>
<li>haproxy配置</li>
</ul>
<pre><code class="language-bash">cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.default
cat&gt;/etc/haproxy/haproxy.cfg&lt;&lt;EOF
global
    log /dev/log local0
    log /dev/log local1 notice
    daemon

defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 1
    timeout http-request    10s
    timeout queue           20s
    timeout connect         5s
    timeout client          20s
    timeout server          20s
    timeout http-keep-alive 10s
    timeout check           10s

frontend apiserver
    bind *:8443
    mode tcp
    option tcplog
    default_backend apiserver

backend apiserver
    option httpchk GET /healthz
    http-check expect status 200
    mode tcp
    option ssl-hello-chk
    balance     roundrobin
        server k8sapivip 10.200.16.101:6443 check
        server k8sapivip 10.200.16.102:6443 check
        server k8sapivip 10.200.16.103:6443 check
EOF
</code></pre>
<ul>
<li>keepalived 主配置</li>
</ul>
<blockquote>
<p>两节点配置不一样</p>
</blockquote>
<pre><code class="language-bash">cp /etc/keepalived/keepalived.conf  /etc/keepalived/keepalived.conf.default
############## 放在 k8s01 ################
cat&gt;/etc/keepalived/keepalived.conf&lt;&lt;EOF
global_defs &#123;
    router_id LVS_DEVEL
&#125;
vrrp_script check_apiserver &#123;
  script &quot;/etc/keepalived/check_apiserver.sh&quot;
  interval 3
  weight -2
  fall 10
  rise 2
&#125;

vrrp_instance VI_1 &#123;
    state MASTER  # 
    interface ens192  # 物理网卡名
    virtual_router_id 51
    priority 101  #
    authentication &#123;
        auth_type PASS
        auth_pass 42
    &#125;
    virtual_ipaddress &#123;
        10.200.16.100
    &#125;
    track_script &#123;
        check_apiserver
    &#125;
&#125;
EOF
############## 放在 k8s02 ################
cat&gt;/etc/keepalived/keepalived.conf&lt;&lt;EOF
global_defs &#123;
    router_id LVS_DEVEL
&#125;
vrrp_script check_apiserver &#123;
  script &quot;/etc/keepalived/check_apiserver.sh&quot;
  interval 3
  weight -2
  fall 10
  rise 2
&#125;

vrrp_instance VI_1 &#123;
    state BACKUP  # 
    interface ens192  # 物理网卡名
    virtual_router_id 51
    priority 100  #
    authentication &#123;
        auth_type PASS
        auth_pass 42
    &#125;
    virtual_ipaddress &#123;
        10.200.16.100
    &#125;
    track_script &#123;
        check_apiserver
    &#125;
&#125;
EOF
</code></pre>
<ul>
<li>keepalived 检测脚本</li>
</ul>
<blockquote>
<p>k8s01和k8s02均需要</p>
</blockquote>
<pre><code class="language-bash">cat&gt;/etc/keepalived/check_apiserver.sh&lt;&lt;'EOF'
#!/bin/sh

errorExit() &#123;
    echo &quot;*** $*&quot; 1&gt;&amp;2
    exit 1
&#125;

APISERVER_VIP=10.200.16.100
APISERVER_DEST_PORT=6443
curl --silent --max-time 2 --insecure https://localhost:$&#123;APISERVER_DEST_PORT&#125;/ -o /dev/null || errorExit &quot;Error GET https://localhost:$&#123;APISERVER_DEST_PORT&#125;/&quot;
if ip addr | grep -q $&#123;APISERVER_VIP&#125;; then
    curl --silent --max-time 2 --insecure https://$&#123;APISERVER_VIP&#125;:$&#123;APISERVER_DEST_PORT&#125;/ -o /dev/null || errorExit &quot;Error GET https://$&#123;APISERVER_VIP&#125;:$&#123;APISERVER_DEST_PORT&#125;/&quot;
fi
EOF

chmod a+x /etc/keepalived/check_apiserver.sh
</code></pre>
<ul>
<li>启动keepalived和haproxy</li>
</ul>
<pre><code class="language-bash">systemctl start keepalived haproxy
systemctl enable keepalived haproxy
</code></pre>
<h2 id="控制平面节点">控制平面节点</h2>
<h3 id="拉取组件镜像">拉取组件镜像</h3>
<blockquote>
<p>k8s01，k8s02，k8s03 执行</p>
</blockquote>
<blockquote>
<p>鉴于网络问题，所以国内一般无法直接运行初始化命令，因此最好先自行安装好包</p>
</blockquote>
<pre><code class="language-bash"># 查看对应版本 k8s 所需包
yum list --showduplicates kubeadm --disableexcludes=kubernetes | grep $&#123;master_verions&#125;
===
kubeadm.x86_64                       1.20.8-0                        @kubernetes
kubeadm.x86_64                       1.20.0-0                        kubernetes
kubeadm.x86_64                       1.20.1-0                        kubernetes
kubeadm.x86_64                       1.20.2-0                        kubernetes
kubeadm.x86_64                       1.20.4-0                        kubernetes
kubeadm.x86_64                       1.20.5-0                        kubernetes
kubeadm.x86_64                       1.20.6-0                        kubernetes
kubeadm.x86_64                       1.20.7-0                        kubernetes
kubeadm.x86_64                       1.20.8-0                        kubernetes
</code></pre>
<pre><code class="language-bash">full_version=1.20.8
kubeadm config images list --kubernetes-version=$&#123;full_version&#125;
===
k8s.gcr.io/kube-apiserver:v1.20.8
k8s.gcr.io/kube-controller-manager:v1.20.8
k8s.gcr.io/kube-scheduler:v1.20.8
k8s.gcr.io/kube-proxy:v1.20.8
k8s.gcr.io/pause:3.2
k8s.gcr.io/etcd:3.4.13-0
k8s.gcr.io/coredns:1.7.0
</code></pre>
<p>根据上面的输出版本，修改下面脚本中 <code>pause</code> <code>etcd</code> <code>coredns</code> 的版本号</p>
<pre><code class="language-bash">cat&gt;images-pull.sh&lt;&lt;EOF
#!/bin/bash
# kubeadm config images list
images=(
kube-apiserver:v$&#123;full_version&#125;
kube-controller-manager:v$&#123;full_version&#125;
kube-scheduler:v$&#123;full_version&#125;
kube-proxy:v$&#123;full_version&#125;
pause:3.2     # 修改我
etcd:3.4.13-0 # 修改我
coredns:1.7.0 # 修改我
)
for imageName in \$&#123;images[@]&#125;;
do
    docker pull registry.aliyuncs.com/google_containers/\$&#123;imageName&#125;
    docker tag registry.aliyuncs.com/google_containers/\$&#123;imageName&#125; k8s.gcr.io/\$&#123;imageName&#125;
    docker rmi registry.aliyuncs.com/google_containers/\$&#123;imageName&#125;
done
EOF
</code></pre>
<pre><code class="language-bash">bash images-pull.sh
</code></pre>
<h3 id="第一个控制平面节点安装（k8s01）">第一个控制平面节点安装（k8s01）</h3>
<p>(info: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/%EF%BC%89">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/）</a></p>
<h4 id="采取配置文件安装模式">采取配置文件安装模式</h4>
<pre><code class="language-bash">kubeadm config print init-defaults &gt; kubeadm.yaml.default
</code></pre>
<p>配置文件详细参数介绍</p>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration">https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration</a></p>
<p>根据生成的默认配置，来动态的调整，因为 k8s 版本变更很快，所以下面的配置不一定是正确的</p>
<pre><code class="language-bash">cat &gt; kubeadm.yaml &lt;&lt; EOF
# kubeadm.yaml 将默认的配置进行修改
apiVersion: kubeadm.k8s.io/v1beta2
bootstrapTokens:
- groups:
  - system:bootstrappers:kubeadm:default-node-token
  token: abcdef.8272827282sksksu   # 改我，改成你自己随意的字符串
  ttl: 24h0m0s
  usages:
  - signing
  - authentication
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: 10.200.16.101  # 改我，改成第一个控制平面节点的物理ip
  bindPort: 6443
nodeRegistration:
  criSocket: /var/run/dockershim.sock  # 如果是containerd，则改为/run/containerd/containerd.sock
  name: k8s01 # 改我，理论上它会自动获取配置所在节点的 hostname
  taints:
  - effect: NoSchedule
    key: node-role.kubernetes.io/master
---
apiServer:
  timeoutForControlPlane: 4m0s
apiVersion: kubeadm.k8s.io/v1beta2
certificatesDir: /etc/kubernetes/pki
clusterName: kubernetes
controllerManager: &#123;&#125;
controllerManagerExtraArgs:
  address: 0.0.0.0  # 开放kube-controller-manager，便于之后prometheus监控
scheduler: &#123;&#125;
schedulerExtraArgs:
  address: 0.0.0.0  # 开放kube-scheduller，便于之后prometheus监控
controlPlaneEndpoint: &quot;k8sapi:8443&quot; # 新加我，k8sapi 是 apiserver 的负载均衡器的地址
dns:
  type: CoreDNS
etcd:
  local:
    dataDir: /var/lib/etcd
imageRepository: k8s.gcr.io # 如果你无法访问k8s.gcr.io，且没有提前下载阿里云镜像，你可以换成 registry.aliyuncs.com/google_containers 试试, 建议提前下载好
kind: ClusterConfiguration
kubernetesVersion: v$&#123;full_version&#125; # 改我，改成你所需安装的版本
networking:
  dnsDomain: cluster.local
  serviceSubnet: 10.96.0.0/16 # 改我，定义 svc 的网段
  podSubnet: 10.97.0.0/16 # 改我，定义 pod 的网段
  
--- # 追加 KubeProxyConfiguration
apiVersion: kubeproxy.config.k8s.io/v1alpha1
kind: KubeProxyConfiguration
mode: ipvs
EOF
--- # 追加 KubeletConfiguration
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
cgroupDriver: systemd
</code></pre>
<pre><code class="language-bash"># 进行初始化安装
kubeadm init --config kubeadm.yaml
</code></pre>
<p>init调用配置流程：</p>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/kubelet-integration/#workflow-when-using-kubeadm-init">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/kubelet-integration/#workflow-when-using-kubeadm-init</a></p>
<h4 id="配置通过-kubectl-访问集群">配置通过 kubectl 访问集群</h4>
<pre><code class="language-bash">mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
# kubectl 命令补全
source &lt;(kubectl completion bash)

# You should now deploy a pod network to the cluster.
# Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
# https://kubernetes.io/docs/concepts/cluster-administration/addons/
</code></pre>
<pre><code class="language-bash"># 添加用户上下文到配置里，方便切换用户
kubectl config set-context admin --cluster=kubernetes --user=kubernetes-admin
</code></pre>
<h4 id="调整-kube-controller-manager-和-scheduler-的配置">调整 kube-controller-manager 和 scheduler 的配置</h4>
<pre><code class="language-bash"># 检查状态
kubectl get cs
# 你可能会发现,出现服务连接拒绝问题
controller-manager   Unhealthy   Get http://127.0.0.1:10252/healthz: dial tcp 127.0.0.1:10252: connect: connection refused
scheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: connect: connection refused
# 原因是这两个服务配置默认端口是0。至于为啥就不晓得了
# 你需要注释掉两个配置里的端口（- --port=0），恢复为默认端口
sed -i '/- --port=0/d' /etc/kubernetes/manifests/kube-scheduler.yaml
sed -i '/- --port=0/d' /etc/kubernetes/manifests/kube-controller-manager.yaml
# 重启 kubelet
systemctl restart kubelet
# 再次检查
kubectl get cs
===
NAME                 STATUS    MESSAGE             ERROR
scheduler            Healthy   ok
controller-manager   Healthy   ok
etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;
</code></pre>
<blockquote>
<p><code>kube-controller-manager</code> 参数 <code>terminated-pod-gc-threshold</code>用于设置保留多少失败的Pod状态，默认是12500。这么高不清楚是否有性能影响或者资源溢出风险。</p>
</blockquote>
<h4 id="配置网络插件">配置网络插件</h4>
<p>网络插件常用的有两种</p>
<p>第一种是 flannel，涉及到更多的 iptables 规则</p>
<p>第二种是 calico，涉及到更多的路由规则</p>
<ul>
<li>flannel (本文档选用的插件)</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/coreos/flannel">https://github.com/coreos/flannel</a> 代码托管地址</p>
</blockquote>
<pre><code class="language-bash">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
# 修改里面的 &quot;Network&quot;: &quot;10.244.0.0/16&quot;, 变更为你自己的 podSubnet 网段，即kubeadm初始化阶段的 --pod-network-cidr
kubectl apply -f  kube-flannel.yml
</code></pre>
<p>flannel 将会在每一个节点上创建一个 VTEP 设备<code>flannel.1</code>，并将podSubnet下发给所有的<code>flannel.1</code></p>
<ul>
<li>calico</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.projectcalico.org/getting-started/kubernetes/quickstart">https://docs.projectcalico.org/getting-started/kubernetes/quickstart</a> 安装文档</p>
</blockquote>
<pre><code class="language-bash">kubectl apply -f https://docs.projectcalico.org/manifests/tigera-operator.yaml
wget https://docs.projectcalico.org/manifests/custom-resources.yaml
# custom-resources.yaml 修改里面的网络为 pod 网段
kubectl apply -f custom-resources.yaml
</code></pre>
<blockquote>
<p>注意，当你使用了 calico 后， 会生成一些 cni 的配置，这些配置会导致你返回 flannel 的时候出现问题。例如无法创建 cni</p>
<p>你可以使用 find / -name ‘*calico*’ 找到所有信息，然后都删除</p>
</blockquote>
<p>默认kubeadm安装完后，禁止调度pod到master上。你可以通过下面的命令，关闭所有master节点的禁止调度</p>
<pre><code class="language-bash"> kubectl taint nodes --all node-role.kubernetes.io/master-
</code></pre>
<h4 id="配置web控制台dashboard">配置web控制台dashboard</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard">https://github.com/kubernetes/dashboard</a> 代码托管地址</p>
</blockquote>
<pre><code class="language-bash">wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml &amp;&amp; mv recommended.yaml kubernetes-dashboard.yaml
</code></pre>
<ul>
<li>如果你部署了 metallb，或者有云服务的 lb，那么只需要修改 kubernetes-dashboard.yaml 配置中的 svc 对象类型为  LoadBalancer</li>
</ul>
<pre><code class="language-yaml">kind: Service
apiVersion: v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kubernetes-dashboard
spec:
  ports:
    - port: 443
      targetPort: 8443
  type: LoadBalancer   # 这里新加一条
  selector:
    k8s-app: kubernetes-dashboard
</code></pre>
<p>之后通过 lb 地址访问即可</p>
<ul>
<li>如果你没有配置 metallb，也没有部署在云服务中（即没有云LB），那么需要修改 svc 类型为 NodePort，并且将 pod 的部署到固定的节点上，例如 k8s01</li>
</ul>
<pre><code class="language-bash"># 这里我们要修改一些东西
# 
#---
spec:
  ports:
    - port: 443
      targetPort: 8443
      nodePort: 30001
  type: NodePort   # 这里新加一条
#---
# 还需要修改一下部署的位置，如果你集群中已经加入了多个节点，则会导致 pod 分发到其它节点上。这里我们强制分发到 master 上. 找到 kind: Deployment 配置，并修改两个 pod 的分发位置为 nodeName: &lt;master 节点主机名&gt;
#---
    spec:
      nodeName: k8s01    # 这里新加一条
      containers:
        - name: kubernetes-dashboard
          image: kubernetesui/dashboard:v2.0.3
          
    spec:
      nodeName: k8s01    # 这里新加一条
      containers:
        - name: dashboard-metrics-scraper
          image: kubernetesui/metrics-scraper:v1.0.4          
#---
# 然后创建
kubectl create -f kubernetes-dashboard.yaml
</code></pre>
<p>之后通过 <a target="_blank" rel="noopener" href="https://k8s01:30001">https://k8s01:30001</a> 访问</p>
<ul>
<li>获取访问web服务的token</li>
</ul>
<p>dashboard本身是一个pod，如果你想让pod去访问其它的k8s资源，则需要给pod创建一个服务账户(serviceaccount).</p>
<p>构建一个服务账户admin-user，并通过ClusterRoleBinding授权admin级别的ClusterRole对象</p>
<pre><code class="language-bash"># 添加访问 token
# 官方文档： https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md
# 通过下面内容创建 kube-db-auth.yaml
cat &gt; kube-db-auth.yaml &lt;&lt; EOF
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kubernetes-dashboard
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard
EOF
kubectl apply -f kube-db-auth.yaml
# 通过下面命令拿到 token
kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '&#123;print $1&#125;')  
</code></pre>
<p><img src="/posts/9602dad/image-20210711163654410.png" alt="image-20210711163654410"></p>
<h3 id="获取其他节点加入集群的命令（k8s01）">获取其他节点加入集群的命令（k8s01）</h3>
<h4 id="新加控制平面">新加控制平面</h4>
<pre><code class="language-bash"># 命令格式
kubeadm join k8sapi:8443 \
--token xxx \
--discovery-token-ca-cert-hash xxx \
--control-plane --certificate-key xxx
</code></pre>
<h4 id="新加Node节点">新加Node节点</h4>
<pre><code class="language-bash"># 命令格式
kubeadm join k8sapi:8443 \
--token xxx \
--discovery-token-ca-cert-hash xxx 
</code></pre>
<h4 id="命令重建">命令重建</h4>
<p>添加Node节点命令</p>
<pre><code class="language-bash"># 添加Node节点的命令
add_node_command=`kubeadm token create --print-join-command`
echo $&#123;add_node_command&#125;
</code></pre>
<p>添加控制平面节点命令</p>
<pre><code class="language-bash"># 创建 --certificate-key
join_certificate_key=`kubeadm init phase upload-certs --upload-certs|tail -1`
# 命令组合
echo &quot;$&#123;add_node_command&#125; --control-plane --certificate-key $&#123;join_certificate_key&#125;&quot;
</code></pre>
<h3 id="k8s02和k8s03作为控制平面添加到集群">k8s02和k8s03作为控制平面添加到集群</h3>
<pre><code class="language-bash">kubeadm join k8sapi:8443 \
--token h77qhb.cjj8ig4t2v15dncm \
--discovery-token-ca-cert-hash sha256:b7138bb76d19d3d7baf832e46559c400f4fe544d8f0ee81a87f \
--control-plane --certificate-key fd996c7c0c2047c9c10a377f25a332bf4b5b00ca
# 
sed -i '/- --port=0/d' /etc/kubernetes/manifests/kube-scheduler.yaml
sed -i '/- --port=0/d' /etc/kubernetes/manifests/kube-controller-manager.yaml
# 重启 kubelet
systemctl restart kubelet

# 根据提示，执行相关命令，一般都是下面的命令
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

# 等待一分钟，查看所有 pod 是否正常
kubectl get pod -n kube-system
===
NAME                            READY   STATUS    RESTARTS   AGE
coredns-74ff55c5b-9gkgk         1/1     Running   0          2d13h
coredns-74ff55c5b-tndb5         1/1     Running   0          15d
etcd-k8s01                      1/1     Running   0          15d
etcd-k8s02                      1/1     Running   0          7m12s
etcd-k8s03                      1/1     Running   0          15d
kube-apiserver-k8s01            1/1     Running   0          26h
kube-apiserver-k8s02            1/1     Running   0          7m11s
kube-apiserver-k8s03            1/1     Running   0          26h
kube-controller-manager-k8s01   1/1     Running   0          15d
kube-controller-manager-k8s02   1/1     Running   0          82s
kube-controller-manager-k8s03   1/1     Running   1          15d
kube-flannel-ds-42hng           1/1     Running   0          15d
kube-flannel-ds-b42qj           1/1     Running   0          15d
kube-flannel-ds-ss8w5           1/1     Running   0          15d
kube-proxy-2xxpn                1/1     Running   0          15d
kube-proxy-pg7j7                1/1     Running   0          15d
kube-proxy-txh2t                1/1     Running   0          15d
kube-scheduler-k8s01            1/1     Running   0          15d
kube-scheduler-k8s02            1/1     Running   0          82s
kube-scheduler-k8s03            1/1     Running   0          15d
</code></pre>
<h4 id="问题点：etcd已有节点信息">问题点：etcd已有节点信息</h4>
<p>如果etcd中曾经有k8s02和k8s03的节点信息，则你需要先从etcd中删除，否则加入的时候，会卡在检测etcd处，并最终报错.</p>
<p>删除etcd信息方式：</p>
<pre><code class="language-bash"># 输出 etcd 节点 id
ETCD=`docker ps|grep etcd|grep -v POD|awk '&#123;print $1&#125;'`
docker exec \
  -it $&#123;ETCD&#125; \
  etcdctl \
  --endpoints https://127.0.0.1:2379 \
  --cacert /etc/kubernetes/pki/etcd/ca.crt \
  --cert /etc/kubernetes/pki/etcd/peer.crt \
  --key /etc/kubernetes/pki/etcd/peer.key \
  member list
===
2f401672c9a538f1, started, k8s01, https://10.200.16.101:2380, https://10.200.16.101:2379, false
d6d9ca2a70f6638e, started, k8s02, https://10.200.16.102:2380, https://10.200.16.102:2379, false
ee0e9340a5cfb4d7, started, k8s03, https://10.200.16.103:2380, https://10.200.16.103:2379, false

# 假设这里我要删除 k8s03
ETCD=`docker ps|grep etcd|grep -v POD|awk '&#123;print $1&#125;'`
docker exec \
  -it $&#123;ETCD&#125; \
  etcdctl \
  --endpoints https://127.0.0.1:2379 \
  --cacert /etc/kubernetes/pki/etcd/ca.crt \
  --cert /etc/kubernetes/pki/etcd/peer.crt \
  --key /etc/kubernetes/pki/etcd/peer.key \
  member remove ee0e9340a5cfb4d7
</code></pre>
<h2 id="Node节点">Node节点</h2>
<blockquote>
<p>加入命令，位于 k8s01初始化命令尾部，worker加入的时候，不需要添加 --control-plane --certificate-key</p>
</blockquote>
<pre><code class="language-bash">kubeadm join k8sapi:8443 \
--token h77qhb.cjj8ig4t2v15dncm \
--discovery-token-ca-cert-hash sha256:b7138bb76d19d3d7baf832e46559c400f4fe544d8f0ee81a87f
</code></pre>
<h2 id="其他内容">其他内容</h2>
<h3 id="容器中显示正确的可见资源">容器中显示正确的可见资源</h3>
<p>默认情况下,不管你如何设置资源限制,容器里的可见资源都等于节点资源.也就是说你在容器里查看/proc/meminfo显示的资源并不是你设置的.这个问题会带来很多麻烦.</p>
<p>因为很多程序的参数都是根据可见资源来设定的.例如nginx的auto, 或者jvm里的内存参数.</p>
<blockquote>
<p>从 Java 8u191开始, jvm 已经默认实现了容器感知( -XX:+UseContainerSupport). 因此无需安装下面的 lxcfs 方案.</p>
<p>并且, 在容器中建议只设置如下内存参数:</p>
<p>-XX:MaxRAMPercentage  最大堆内存=物理内存百分比, 建议为容器限制的50%-75% . 毕竟还需要预留其它内存.</p>
</blockquote>
<p>而社区常见的作法是用<code>lxcfs</code> 来提升资源的可见性.<code>lxcfs</code> 是一个开源的FUSE（用户态文件系统）实现来支持LXC容器, 它也可以支持Docker容器.</p>
<p>LXCFS通过用户态文件系统, 在容器中提供下列 <code>procfs</code> 的文件.</p>
<pre><code class="language-bash">/proc/cpuinfo
/proc/diskstats
/proc/meminfo
/proc/stat
/proc/swaps
/proc/uptime
</code></pre>
<p>与我们资源限制有关的, 主要是 cpuinfo 和 meminfo.</p>
<p>目前社区的做法如下:</p>
<ol>
<li>
<p>所有节点安装 fuse-libs 包.</p>
<pre><code class="language-bash">yum install -y fuse-libs
</code></pre>
</li>
<li>
<p>集群部署 lxcfs 的 deployment 资源对象</p>
<pre><code class="language-bash">git clone https://github.com/denverdino/lxcfs-admission-webhook.git
cd lxcfs-admission-webhook
vim deployment/lxcfs-daemonset.yaml
=== 修正配置里的 apiVersion
=== 当前git里的代码是陈旧的...代码里的版本在 1.18 已经被废弃). 具体归属于什么版本, 请参考k8s官方api文档 
=== https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19/#daemonset-v1-apps
apiVersion:apps/v1  

kubectl apply -f deployment/lxcfs-daemonset.yaml
kubectl get pod
#等待 lxcfs pod 状态成 running
#如果你发现 pod 始终出错，那么执行下列命令：
kubectl delete -f deployment/lxcfs-daemonset.yaml
rm -rf /var/lib/lxcfs
kubectl apply -f deployment/lxcfs-daemonset.yaml

deployment/install.sh
kubectl get secrets,pods,svc,mutatingwebhookconfigurations
</code></pre>
</li>
<li>
<p>给相关namespace注入lxcfs，例如default</p>
<pre><code class="language-bash">kubectl label namespace default lxcfs-admission-webhook=enabled
</code></pre>
</li>
<li>
<p>重启添加了资源限制的pod, 此时 /proc/cpuinfo 和 /proc/meminfo 将会正确显示.</p>
</li>
</ol>
<h3 id="集群指标监控服务">集群指标监控服务</h3>
<p>添加 metrics-server  <a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/metrics-server#configuration">https://github.com/kubernetes-sigs/metrics-server#configuration</a></p>
<pre><code class="language-bash">wget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
# 修改metrics-server容器参数部分，添加额外的启动参数(arg)
args:
  - --kubelet-preferred-address-types=InternalIP
  - --kubelet-insecure-tls
kubectl apply -f components.yaml
kubectl get --raw &quot;/apis/metrics.k8s.io/v1beta1/nodes&quot;
</code></pre>
<blockquote>
<p>kubectl top 指令需要指标才能输出</p>
</blockquote>
<hr>
<h2 id="kubectl-命令文档">kubectl 命令文档</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a></p>
</blockquote>
<p>一些常用的命令</p>
<ol>
<li>kubectl explain</li>
</ol>
<blockquote>
<p>非常有用的命令，帮助你写配置文件</p>
</blockquote>
<p>输出配置某个字段的详细说明,例如 deployment.metadata</p>
<blockquote>
<p>其中标注有 -required- 的字段是必选字段</p>
</blockquote>
<pre><code class="language-bash">kubectl explain deployment.metadata
</code></pre>
<ol start="2">
<li>-o yaml --dry-run</li>
</ol>
<p>输出create命令的yaml配置</p>
<pre><code class="language-bash">kubectl create serviceaccount mysvcaccount -o yaml --dry-run
</code></pre>
<ol start="3">
<li>常用的工具容器</li>
</ol>
<pre><code class="language-bash">kubectl run cirros-$RANDOM -it --rm --restart=Never --image=cirros -- /bin/sh
kubectl run dnstools-$RANDOM -it --rm --restart=Never --image=infoblox/dnstools:latest 
</code></pre>
<h3 id="kubectl-调用的配置">kubectl 调用的配置</h3>
<pre><code class="language-yaml">➜   kubectl config view
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://&lt;api_server&gt;:8443
  name: kubernetes-qa
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://&lt;api_server&gt;:6443
  name: kubernetes-prod
  
contexts:
- context:
    cluster: kubernetes-prod
    user: kubernetes-admin
  name: prod
- context:
    cluster: kubernetes-qa
    user: user-kfktf786bk
  name: qa
  
current-context: qa           ## 当前使用的配置
kind: Config
preferences: &#123;&#125;

users:
- name: kubernetes-admin
  user:
    client-certificate-data: REDACTED
    client-key-data: REDACTED
- name: user-kfktf786bk
  user:
    client-certificate-data: REDACTED
    client-key-data: REDACTED
</code></pre>
<h2 id="删除与清理">删除与清理</h2>
<pre><code class="language-bash"># 从集群里删除某个节点
# master exec
kubectl drain &lt;NODE_ID&gt; --delete-local-data --force --ignore-daemonsets
kubectl delete node &lt;NODE_ID&gt;
# worker exec
kubeadm reset
iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X
ipvsadm --clear;
ip link set cni0 down &amp;&amp; ip link delete cni0;
ip link set flannel.1 down &amp;&amp; ip link delete flannel.1;
ip link set kube-ipvs0 down &amp;&amp; ip link delete kube-ipvs0;
ip link set dummy0 down &amp;&amp; ip link delete dummy0;
rm -rf /var/lib/cni/
rm -rf $HOME/.kube;
</code></pre>
<h2 id="节点一致性测试">节点一致性测试</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/node-conformance/">https://kubernetes.io/docs/setup/node-conformance/</a></p>
</blockquote>

</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/posts/c3c9f0f8/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  k8s☞02-1切换使用runtime-containerd
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/posts/e1096625/">
                k8s☞记录点
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>



	<div id="vcomments"></div>


<script>
	
		// 评论
		new Valine({
			el: '#vcomments',
			appId: 'Sq2igagqhmGqvs3eHHtcNKiB-gzGzoHsz',
			appKey: 'cDTpqcpogeQq55SOuBHEXv9W',
			placeholder: '写点东西吧',
			path: window.location.pathname,
			avatar: 'retro',
			highlight: false,
      recordIP: true,
      enableQQ: true,
			requiredFields: ['nick','mail']
		})
	
	
    // 显示次数
		function showTime(Counter) {
			var query = new AV.Query("Counter");
			if($(".leancloud_visitors").length > 0){
				var url = $(".leancloud_visitors").attr('id').trim();
				// where field
				query.equalTo("words", url);
				// count
				query.count().then(function (number) {
					// There are number instances of MyClass where words equals url.
					$(document.getElementById(url)).text(number?  number : '--');
				}, function (error) {
					// error is an instance of AVError.
				});
			}
		}
		// 追加pv
		function addCount(Counter) {
			var url = $(".leancloud_visitors").length > 0 ? $(".leancloud_visitors").attr('id').trim() : 'wujun234.github.io';
			var Counter = AV.Object.extend("Counter");
			var query = new Counter;
			query.save({
				words: url
			}).then(function (object) {
			})
		}
		$(function () {
			var Counter = AV.Object.extend("Counter");
			addCount(Counter);
			showTime(Counter);
		});
	
</script>
	</div>
	<div id="footer">
	<p>
	©2016-<span id="footerYear"></span> 
	<a href="/">zyh</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//github.com/wujun234" target="_blank">WuJun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>
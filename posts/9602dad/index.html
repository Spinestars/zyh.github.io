<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>k8s☞02v1.18.6安装 | zyh</title>
  <meta name="keywords" content=" 容器 , k8s ">
  <meta name="description" content="k8s☞02v1.18.6安装 | zyh">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta property="og:type" content="website">
<meta property="og:title" content="404">
<meta property="og:url" content="https://zyh.cool/404.html">
<meta property="og:site_name" content="zyh">
<meta property="og:locale">
<meta property="article:published_time" content="2020-05-14T01:46:07.000Z">
<meta property="article:modified_time" content="2020-05-14T01:46:07.000Z">
<meta property="article:author" content="zyh">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 5.4.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>zyh</span>
</div>

<div class="icon">
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <a title="email"
               href="mailto:aaa103439@hotmail.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=763421462&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
</div>




<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(93)</small>
            
        </div>
    </li>
    
        
            
                <li>
                    <div data-rel="数据库">
                        <i class="fold iconfont icon-right"></i>
                        
                        数据库
                        <small>(5)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="数据库<--->mysql">
                                        
                                        mysql
                                        
                                            <small>(2
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="数据库<--->redis">
                                        
                                        redis
                                        
                                            <small>(3
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="安装">
                        
                        安装
                        <small>(7)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="公有云">
                        <i class="fold iconfont icon-right"></i>
                        
                        公有云
                        <small>(2)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="公有云<--->aliyun">
                                        
                                        aliyun
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="公有云<--->aws">
                                        
                                        aws
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="监控">
                        <i class="fold iconfont icon-right"></i>
                        
                        监控
                        <small>(14)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="监控<--->monit">
                                        
                                        monit
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="监控<--->prometheus">
                                        
                                        prometheus
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="监控<--->zabbix">
                                        
                                        zabbix
                                        
                                            <small>(7
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="其它">
                        <i class="fold iconfont icon-right"></i>
                        
                        其它
                        <small>(3)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="其它<--->网络">
                                        
                                        网络
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="日志">
                        
                        日志
                        <small>(2)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="容器">
                        <i class="fold iconfont icon-right"></i>
                        
                        容器
                        <small>(21)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="容器<--->docker">
                                        
                                        docker
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="容器<--->k8s">
                                        
                                        k8s
                                        
                                            <small>(20
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
        
    
        
            
                <li>
                    <div data-rel="系统">
                        <i class="fold iconfont icon-right"></i>
                        
                        系统
                        <small>(6)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="系统<--->linux">
                                        
                                        linux
                                        
                                            <small>(5
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="系统<--->windows">
                                        
                                        windows
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="语言">
                        <i class="fold iconfont icon-right"></i>
                        
                        语言
                        <small>(2)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="语言<--->java">
                                        
                                        java
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="语言<--->shell">
                                        
                                        shell
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="自动化">
                        <i class="fold iconfont icon-right"></i>
                        
                        自动化
                        <small>(20)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="自动化<--->ansible">
                                        
                                        ansible
                                        
                                            <small>(17
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="自动化<--->jenkins">
                                        
                                        jenkins
                                        
                                            <small>(3
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                <li>
                    <div data-rel="web">
                        <i class="fold iconfont icon-right"></i>
                        
                        web
                        <small>(6)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="web<--->nginx">
                                        
                                        nginx
                                        
                                            <small>(4
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="93">
<input type="hidden" id="yelog_site_word_count" value="70.5k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://zyh.cool">zyh</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>安装</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>备份</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>承载</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>磁盘</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>工具</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>监控</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>交换机</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>企业微信</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>容器</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>升级</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>时区</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>问题记录</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>优化</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>邮件</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>证书</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>资源约束</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>alias</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>aliyun</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ansible</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>authorization</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>aws</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ConfigMap</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>DaemonSet</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>deployment</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>docker</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ELK</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>fcgi</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>handle</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hexo</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>include</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ingress</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jdk</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jenkins</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>k8s</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>kubeadm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>log</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>logrotate</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>lookup</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mfa</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>monit</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mysql</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mysqldump</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>namespace</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>network</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>nginx</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>openvpn</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>oss</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>php</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>php-fpm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pod</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>prometheus</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>raid</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>redis</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>s3</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>S5700</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>scoop</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Secret</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>service</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>shell</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ssh</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>StatefulSet</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>storage</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ubuntu</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>vsftpd</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>web</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>wechat</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>windows</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>zabbix</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a  class="All "
           href="/posts/734e33cb/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="hexo☞gitalk跨域错误">hexo☞gitalk跨域错误</span>
            <span class="post-date" title="2021-02-24 10:09:26">2021/02/24</span>
        </a>
        
        <a  class="All 自动化 jenkins "
           href="/posts/3b5cd3e1/"
           data-tag="jenkins,k8s"
           data-author="" >
            <span class="post-title" title="jenkins☞动态agent">jenkins☞动态agent</span>
            <span class="post-date" title="2021-01-16 20:07:13">2021/01/16</span>
        </a>
        
        <a  class="All 公有云 aliyun "
           href="/posts/b5d7d6ee/"
           data-tag="aliyun,oss"
           data-author="" >
            <span class="post-title" title="aliyun☞oss">aliyun☞oss</span>
            <span class="post-date" title="2020-11-24 16:48:43">2020/11/24</span>
        </a>
        
        <a  class="All 其它 网络 "
           href="/posts/5290b79d/"
           data-tag="交换机,S5700"
           data-author="" >
            <span class="post-title" title="网络☞S5700配置攻击朔源">网络☞S5700配置攻击朔源</span>
            <span class="post-date" title="2020-11-17 18:26:58">2020/11/17</span>
        </a>
        
        <a  class="All 系统 linux "
           href="/posts/e4f7ce4c/"
           data-tag="linux,ubuntu,network"
           data-author="" >
            <span class="post-title" title="linux☞ubuntu20.04纯命令行网卡配置">linux☞ubuntu20.04纯命令行网卡配置</span>
            <span class="post-date" title="2020-11-16 15:04:08">2020/11/16</span>
        </a>
        
        <a  class="All 监控 "
           href="/posts/ab1247fb/"
           data-tag="mysql,监控"
           data-author="" >
            <span class="post-title" title="监控☞mysql慢sql预警">监控☞mysql慢sql预警</span>
            <span class="post-date" title="2020-11-05 15:56:35">2020/11/05</span>
        </a>
        
        <a  class="All "
           href="/posts/7c44c2e8/"
           data-tag="web,承载"
           data-author="" >
            <span class="post-title" title="web☞服务器承载能力计算">web☞服务器承载能力计算</span>
            <span class="post-date" title="2020-10-31 10:48:22">2020/10/31</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/7538d100/"
           data-tag="容器,k8s,kubeadm,升级"
           data-author="" >
            <span class="post-title" title="k8s☞16kubeadm集群升级">k8s☞16kubeadm集群升级</span>
            <span class="post-date" title="2020-10-19 10:50:58">2020/10/19</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/55da993d/"
           data-tag="容器,k8s,证书"
           data-author="" >
            <span class="post-title" title="k8s☞15证书管理">k8s☞15证书管理</span>
            <span class="post-date" title="2020-10-16 11:25:52">2020/10/16</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/a5ed67a6/"
           data-tag="容器,k8s,authorization"
           data-author="" >
            <span class="post-title" title="k8s☞14认证授权">k8s☞14认证授权</span>
            <span class="post-date" title="2020-10-15 16:35:23">2020/10/15</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/1080c6b6/"
           data-tag="容器,k8s,storage"
           data-author="" >
            <span class="post-title" title="k8s☞09存储资源">k8s☞09存储资源</span>
            <span class="post-date" title="2020-09-30 18:23:10">2020/09/30</span>
        </a>
        
        <a  class="All 安装 "
           href="/posts/894f9595/"
           data-tag="k8s,vsftpd"
           data-author="" >
            <span class="post-title" title="安装库☞vsftpd">安装库☞vsftpd</span>
            <span class="post-date" title="2020-09-29 16:19:47">2020/09/29</span>
        </a>
        
        <a  class="All 监控 monit "
           href="/posts/ae41ae33/"
           data-tag="monit"
           data-author="" >
            <span class="post-title" title="监控☞monit">监控☞monit</span>
            <span class="post-date" title="2020-09-27 14:27:54">2020/09/27</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/7627a41d/"
           data-tag="容器,k8s,ingress"
           data-author="" >
            <span class="post-title" title="k8s☞13高级版负载均衡ingress">k8s☞13高级版负载均衡ingress</span>
            <span class="post-date" title="2020-09-22 18:30:04">2020/09/22</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/4bf29cf0/"
           data-tag="容器,k8s,StatefulSet"
           data-author="" >
            <span class="post-title" title="k8s☞12有状态服务StatefulSet">k8s☞12有状态服务StatefulSet</span>
            <span class="post-date" title="2020-09-21 18:30:04">2020/09/21</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/63d8d3d4/"
           data-tag="容器,k8s,DaemonSet"
           data-author="" >
            <span class="post-title" title="k8s☞12守护进程">k8s☞12守护进程</span>
            <span class="post-date" title="2020-09-20 20:30:04">2020/09/20</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/ed4c29d5/"
           data-tag="容器,k8s,资源约束,namespace"
           data-author="" >
            <span class="post-title" title="k8s☞11-2namespace资源约束">k8s☞11-2namespace资源约束</span>
            <span class="post-date" title="2020-09-19 19:30:04">2020/09/19</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/64fa9c84/"
           data-tag="容器,k8s,pod,资源约束"
           data-author="" >
            <span class="post-title" title="k8s☞11-1pod资源约束">k8s☞11-1pod资源约束</span>
            <span class="post-date" title="2020-09-19 18:30:04">2020/09/19</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/4b0e4a5/"
           data-tag="容器,k8s,ConfigMap,Secret"
           data-author="" >
            <span class="post-title" title="k8s☞09应用配置与密码与信息提供">k8s☞09应用配置与密码与信息提供</span>
            <span class="post-date" title="2020-09-17 11:19:04">2020/09/17</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/4b0e4a5/"
           data-tag="容器,k8s,ConfigMap,Secret"
           data-author="" >
            <span class="post-title" title="k8s☞10应用配置与密码与信息提供">k8s☞10应用配置与密码与信息提供</span>
            <span class="post-date" title="2020-09-17 11:19:04">2020/09/17</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/d3b80b5f/"
           data-tag="容器,k8s,service"
           data-author="" >
            <span class="post-title" title="k8s☞08负载均衡service">k8s☞08负载均衡service</span>
            <span class="post-date" title="2020-09-16 17:44:04">2020/09/16</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/18e4fa73/"
           data-tag="容器,k8s,deployment"
           data-author="" >
            <span class="post-title" title="k8s☞06无状态服务deployment-pod更新">k8s☞06无状态服务deployment-pod更新</span>
            <span class="post-date" title="2020-09-14 14:44:04">2020/09/14</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/f6e328b5/"
           data-tag="容器,k8s,deployment"
           data-author="" >
            <span class="post-title" title="k8s☞07无状态服务deployment-pod扩缩">k8s☞07无状态服务deployment-pod扩缩</span>
            <span class="post-date" title="2020-09-14 14:44:04">2020/09/14</span>
        </a>
        
        <a  class="All 数据库 mysql "
           href="/posts/e6ae9474/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="mysql☞常用命令">mysql☞常用命令</span>
            <span class="post-date" title="2020-09-11 15:53:04">2020/09/11</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/9aa66899/"
           data-tag="容器,k8s,pod"
           data-author="" >
            <span class="post-title" title="k8s☞05pod探测器">k8s☞05pod探测器</span>
            <span class="post-date" title="2020-09-04 15:19:04">2020/09/04</span>
        </a>
        
        <a  class="All 监控 zabbix "
           href="/posts/4ebbd3a8/"
           data-tag="zabbix,wechat"
           data-author="" >
            <span class="post-title" title="zabbix☞预警">zabbix☞预警</span>
            <span class="post-date" title="2020-09-02 14:27:54">2020/09/02</span>
        </a>
        
        <a  class="All 监控 zabbix "
           href="/posts/25f36846/"
           data-tag="docker,zabbix,安装"
           data-author="" >
            <span class="post-title" title="zabbix☞容器搭建">zabbix☞容器搭建</span>
            <span class="post-date" title="2020-08-30 20:27:54">2020/08/30</span>
        </a>
        
        <a  class="All 数据库 mysql "
           href="/posts/c83ca575/"
           data-tag="mysql,mysqldump"
           data-author="" >
            <span class="post-title" title="mysql☞离线迁移脚本">mysql☞离线迁移脚本</span>
            <span class="post-date" title="2020-08-29 15:53:04">2020/08/29</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/94518966/"
           data-tag="容器,k8s,pod"
           data-author="" >
            <span class="post-title" title="k8s☞03pod">k8s☞03pod</span>
            <span class="post-date" title="2020-08-26 21:19:04">2020/08/26</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/3ec72f7e/"
           data-tag="容器,k8s,pod"
           data-author="" >
            <span class="post-title" title="k8s☞04pod钩子函数">k8s☞04pod钩子函数</span>
            <span class="post-date" title="2020-08-26 21:19:04">2020/08/26</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/9602dad/"
           data-tag="容器,k8s"
           data-author="" >
            <span class="post-title" title="k8s☞02v1.18.6安装">k8s☞02v1.18.6安装</span>
            <span class="post-date" title="2020-08-25 17:17:44">2020/08/25</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/e1096625/"
           data-tag="容器,k8s"
           data-author="" >
            <span class="post-title" title="k8s☞记录点">k8s☞记录点</span>
            <span class="post-date" title="2020-08-25 01:08:44">2020/08/25</span>
        </a>
        
        <a  class="All 监控 prometheus "
           href="/posts/65820315/"
           data-tag="prometheus"
           data-author="" >
            <span class="post-title" title="prometheus☞搭建">prometheus☞搭建</span>
            <span class="post-date" title="2020-07-26 11:25:44">2020/07/26</span>
        </a>
        
        <a  class="All 监控 zabbix "
           href="/posts/ed865d2f/"
           data-tag="zabbix,监控"
           data-author="" >
            <span class="post-title" title="zabbix☞server安装注意事项">zabbix☞server安装注意事项</span>
            <span class="post-date" title="2020-07-23 22:34:44">2020/07/23</span>
        </a>
        
        <a  class="All 自动化 jenkins "
           href="/posts/3e0f2183/"
           data-tag="jenkins"
           data-author="" >
            <span class="post-title" title="jenkins☞从容器中访问宿主机docker命令">jenkins☞从容器中访问宿主机docker命令</span>
            <span class="post-date" title="2020-06-09 17:24:44">2020/06/09</span>
        </a>
        
        <a  class="All 系统 linux "
           href="/posts/5db0cd07/"
           data-tag="linux,ssh,mfa"
           data-author="" >
            <span class="post-title" title="linux☞ssh-MFA自动登陆">linux☞ssh-MFA自动登陆</span>
            <span class="post-date" title="2020-06-06 11:33:54">2020/06/06</span>
        </a>
        
        <a  class="All 语言 java "
           href="/posts/ac6b3b36/"
           data-tag="jdk"
           data-author="" >
            <span class="post-title" title="jdk☞安装和配置">jdk☞安装和配置</span>
            <span class="post-date" title="2020-06-01 17:35:44">2020/06/01</span>
        </a>
        
        <a  class="All web nginx "
           href="/posts/58a1c0c7/"
           data-tag="nginx,fcgi,php,alias"
           data-author="" >
            <span class="post-title" title="nginx☞fcgi中alias的使用">nginx☞fcgi中alias的使用</span>
            <span class="post-date" title="2020-05-27 14:46:54">2020/05/27</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/720afd15/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞角色">ansible☞角色</span>
            <span class="post-date" title="2020-05-21 12:02:34">2020/05/21</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/724fda19/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞模板">ansible☞模板</span>
            <span class="post-date" title="2020-05-20 20:42:44">2020/05/20</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/6ce01f58/"
           data-tag="ansible,include"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-include">ansible☞playbook-include</span>
            <span class="post-date" title="2020-05-18 17:12:44">2020/05/18</span>
        </a>
        
        <a  class="All "
           href="/posts/f5c218d/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="hexo☞本地搜索">hexo☞本地搜索</span>
            <span class="post-date" title="2020-05-18 12:11:17">2020/05/18</span>
        </a>
        
        <a  class="All 安装 "
           href="/posts/6209085/"
           data-tag="nginx,shell"
           data-author="" >
            <span class="post-title" title="安装库☞nginx">安装库☞nginx</span>
            <span class="post-date" title="2020-05-15 11:48:44">2020/05/15</span>
        </a>
        
        <a  class="All "
           href="/posts/662e9d4d/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="hexo☞图片显示404错误的解决办法">hexo☞图片显示404错误的解决办法</span>
            <span class="post-date" title="2020-05-14 18:45:17">2020/05/14</span>
        </a>
        
        <a  class="All web nginx "
           href="/posts/445cf088/"
           data-tag="nginx,log"
           data-author="" >
            <span class="post-title" title="nginx☞日志切割脚本">nginx☞日志切割脚本</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 监控 zabbix "
           href="/posts/3d20f83e/"
           data-tag="zabbix,监控"
           data-author="" >
            <span class="post-title" title="zabbix☞web监控">zabbix☞web监控</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 监控 zabbix "
           href="/posts/1587f6e8/"
           data-tag="zabbix,监控"
           data-author="" >
            <span class="post-title" title="zabbix☞agent和proxy（yum）">zabbix☞agent和proxy（yum）</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 监控 zabbix "
           href="/posts/b35b5965/"
           data-tag="zabbix,监控"
           data-author="" >
            <span class="post-title" title="zabbix ☞ nginx">zabbix ☞ nginx</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 监控 zabbix "
           href="/posts/6c093771/"
           data-tag="redis,zabbix"
           data-author="" >
            <span class="post-title" title="zabbix☞redis">zabbix☞redis</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 安装 "
           href="/posts/65ab632a/"
           data-tag="docker,redis,shell"
           data-author="" >
            <span class="post-title" title="安装库☞redis">安装库☞redis</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 监控 "
           href="/posts/8c33f887/"
           data-tag="监控,企业微信"
           data-author="" >
            <span class="post-title" title="监控☞企业微信机器人">监控☞企业微信机器人</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 监控 "
           href="/posts/1fac36d/"
           data-tag="监控,磁盘"
           data-author="" >
            <span class="post-title" title="监控 ☞ 远程磁盘检测">监控 ☞ 远程磁盘检测</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 日志 "
           href="/posts/421d605e/"
           data-tag="logrotate"
           data-author="" >
            <span class="post-title" title="日志 ☞ logrotate">日志 ☞ logrotate</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 监控 "
           href="/posts/f9b08c30/"
           data-tag="监控,企业微信"
           data-author="" >
            <span class="post-title" title="监控 ☞ 微信预警">监控 ☞ 微信预警</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 监控 "
           href="/posts/f8f9b4d0/"
           data-tag="监控,邮件"
           data-author="" >
            <span class="post-title" title="监控 ☞ 邮件预警">监控 ☞ 邮件预警</span>
            <span class="post-date" title="2020-05-14 09:34:44">2020/05/14</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/f43dca37/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-过滤器">ansible☞playbook-过滤器</span>
            <span class="post-date" title="2020-05-11 18:18:44">2020/05/11</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/4235ddf4/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞常用模块-文本文件操作">ansible☞常用模块-文本文件操作</span>
            <span class="post-date" title="2020-05-10 17:36:44">2020/05/10</span>
        </a>
        
        <a  class="All "
           href="/posts/3988a5f2/"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="linux☞输出个性化开机状态">linux☞输出个性化开机状态</span>
            <span class="post-date" title="2020-05-09 20:47:17">2020/05/09</span>
        </a>
        
        <a  class="All 其它 "
           href="/posts/1ddb9d4e/"
           data-tag="linux,问题记录"
           data-author="" >
            <span class="post-title" title="问题记录">问题记录</span>
            <span class="post-date" title="2020-05-08 15:41:54">2020/05/08</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/960fc783/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-tags">ansible☞playbook-tags</span>
            <span class="post-date" title="2020-05-04 17:31:44">2020/05/04</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/c4126d5a/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-错误捕获">ansible☞playbook-错误捕获</span>
            <span class="post-date" title="2020-05-04 17:17:44">2020/05/04</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/29683589/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-条件判断">ansible☞playbook-条件判断</span>
            <span class="post-date" title="2020-05-04 16:59:44">2020/05/04</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/14bc184e/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-循环">ansible☞playbook-循环</span>
            <span class="post-date" title="2020-05-04 11:35:44">2020/05/04</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/84eb900/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞常用模块-系统相关">ansible☞常用模块-系统相关</span>
            <span class="post-date" title="2020-04-29 17:16:44">2020/04/29</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/b0929188/"
           data-tag="ansible,handle"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-handle">ansible☞playbook-handle</span>
            <span class="post-date" title="2020-04-28 18:40:44">2020/04/28</span>
        </a>
        
        <a  class="All 数据库 redis "
           href="/posts/2c2d50a0/"
           data-tag="redis,备份"
           data-author="" >
            <span class="post-title" title="redis☞备份">redis☞备份</span>
            <span class="post-date" title="2020-04-27 11:46:44">2020/04/27</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/3d9b9ec1/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞常用模块-软件包管理">ansible☞常用模块-软件包管理</span>
            <span class="post-date" title="2020-04-26 16:36:44">2020/04/26</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/1e274151/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞常用模块-命令调用">ansible☞常用模块-命令调用</span>
            <span class="post-date" title="2020-04-20 17:56:00">2020/04/20</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/4235ddf4/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞常用模块-文本文件操作">ansible☞常用模块-文本文件操作</span>
            <span class="post-date" title="2020-04-20 15:26:44">2020/04/20</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/15aa7d2e/"
           data-tag="ansible,aws"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-aws">ansible☞playbook-aws</span>
            <span class="post-date" title="2020-04-14 20:30:44">2020/04/14</span>
        </a>
        
        <a  class="All 系统 windows "
           href="/posts/22b82d75/"
           data-tag="windows,scoop"
           data-author="" >
            <span class="post-title" title="windows 包管理工具 scoop">windows 包管理工具 scoop</span>
            <span class="post-date" title="2020-04-13 11:11:54">2020/04/13</span>
        </a>
        
        <a  class="All 自动化 jenkins "
           href="/posts/d9cdb70/"
           data-tag="docker,jenkins"
           data-author="" >
            <span class="post-title" title="jenkins☞安装和基本配置">jenkins☞安装和基本配置</span>
            <span class="post-date" title="2020-03-25 12:26:44">2020/03/25</span>
        </a>
        
        <a  class="All 安装 "
           href="/posts/b73a61bf/"
           data-tag="php,shell"
           data-author="" >
            <span class="post-title" title="安装库☞php包管理方式">安装库☞php包管理方式</span>
            <span class="post-date" title="2020-03-22 09:34:44">2020/03/22</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/d3e413b7/"
           data-tag="ansible"
           data-author="" >
            <span class="post-title" title="ansible☞基础信息">ansible☞基础信息</span>
            <span class="post-date" title="2020-03-15 09:30:44">2020/03/15</span>
        </a>
        
        <a  class="All 其它 "
           href="/posts/3827a60a/"
           data-tag="工具"
           data-author="" >
            <span class="post-title" title="工具库">工具库</span>
            <span class="post-date" title="2020-03-12 20:01:11">2020/03/12</span>
        </a>
        
        <a  class="All 系统 linux "
           href="/posts/cd32aa48/"
           data-tag="linux,时区"
           data-author="" >
            <span class="post-title" title="linux☞时间">linux☞时间</span>
            <span class="post-date" title="2020-02-11 12:14:54">2020/02/11</span>
        </a>
        
        <a  class="All 日志 "
           href="/posts/3475106c/"
           data-tag="docker,安装,ELK"
           data-author="" >
            <span class="post-title" title="日志☞ELK简单部署-容器方式">日志☞ELK简单部署-容器方式</span>
            <span class="post-date" title="2019-12-11 14:56:44">2019/12/11</span>
        </a>
        
        <a  class="All web nginx "
           href="/posts/18de0eed/"
           data-tag="nginx"
           data-author="" >
            <span class="post-title" title="nginx ☞ 基本认证">nginx ☞ 基本认证</span>
            <span class="post-date" title="2019-09-04 12:14:54">2019/09/04</span>
        </a>
        
        <a  class="All 系统 linux "
           href="/posts/a7611bc1/"
           data-tag="linux,raid"
           data-author="" >
            <span class="post-title" title="linux☞软raid创建">linux☞软raid创建</span>
            <span class="post-date" title="2019-07-01 15:41:54">2019/07/01</span>
        </a>
        
        <a  class="All 公有云 aws "
           href="/posts/2c5a64ff/"
           data-tag="aws,s3"
           data-author="" >
            <span class="post-title" title="aws☞s3 初始化安装">aws☞s3 初始化安装</span>
            <span class="post-date" title="2019-05-23 15:17:44">2019/05/23</span>
        </a>
        
        <a  class="All 容器 docker "
           href="/posts/b7cf7b1f/"
           data-tag="容器,docker"
           data-author="" >
            <span class="post-title" title="docker☞01安装">docker☞01安装</span>
            <span class="post-date" title="2019-03-20 11:12:44">2019/03/20</span>
        </a>
        
        <a  class="All 容器 k8s "
           href="/posts/aaf9b7/"
           data-tag="容器,k8s"
           data-author="" >
            <span class="post-title" title="k8s☞01常见术语概念">k8s☞01常见术语概念</span>
            <span class="post-date" title="2019-03-20 11:12:44">2019/03/20</span>
        </a>
        
        <a  class="All 安装 "
           href="/posts/b824edd8/"
           data-tag="docker,mysql"
           data-author="" >
            <span class="post-title" title="安装库☞mysql容器搭建">安装库☞mysql容器搭建</span>
            <span class="post-date" title="2019-02-10 15:53:04">2019/02/10</span>
        </a>
        
        <a  class="All web nginx "
           href="/posts/78ceb386/"
           data-tag="nginx"
           data-author="" >
            <span class="post-title" title="nginx ☞ 泛域名_变量截取">nginx ☞ 泛域名_变量截取</span>
            <span class="post-date" title="2018-09-06 20:14:54">2018/09/06</span>
        </a>
        
        <a  class="All 安装 "
           href="/posts/3321a2dc/"
           data-tag="php,shell"
           data-author="" >
            <span class="post-title" title="安装库☞php编译方式">安装库☞php编译方式</span>
            <span class="post-date" title="2018-08-21 16:02:44">2018/08/21</span>
        </a>
        
        <a  class="All web "
           href="/posts/d1d65c30/"
           data-tag="php-fpm"
           data-author="" >
            <span class="post-title" title="php☞fpm静态配置">php☞fpm静态配置</span>
            <span class="post-date" title="2018-05-11 11:14:00">2018/05/11</span>
        </a>
        
        <a  class="All 安装 "
           href="/posts/7c1abbe1/"
           data-tag="docker,openvpn"
           data-author="" >
            <span class="post-title" title="安装库☞openvpn">安装库☞openvpn</span>
            <span class="post-date" title="2018-03-22 09:34:44">2018/03/22</span>
        </a>
        
        <a  class="All 数据库 redis "
           href="/posts/28361833/"
           data-tag="redis,优化"
           data-author="" >
            <span class="post-title" title="redis☞调整内核参数">redis☞调整内核参数</span>
            <span class="post-date" title="2018-02-02 14:08:11">2018/02/02</span>
        </a>
        
        <a  class="All 数据库 redis "
           href="/posts/28361833/"
           data-tag="redis,优化"
           data-author="" >
            <span class="post-title" title="redis☞调整内核参数">redis☞调整内核参数</span>
            <span class="post-date" title="2018-02-02 14:08:11">2018/02/02</span>
        </a>
        
        <a  class="All web "
           href="/posts/f41d0763/"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="web ☞ 系统基本优化">web ☞ 系统基本优化</span>
            <span class="post-date" title="2017-01-20 15:24:54">2017/01/20</span>
        </a>
        
        <a  class="All 语言 shell "
           href="/posts/241ce96c/"
           data-tag="shell"
           data-author="" >
            <span class="post-title" title="shell☞if判定">shell☞if判定</span>
            <span class="post-date" title="2016-10-02 22:11:44">2016/10/02</span>
        </a>
        
        <a  class="All 系统 linux "
           href="/posts/a3dfc0e8/"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="linux☞df与du数据不一致的原因">linux☞df与du数据不一致的原因</span>
            <span class="post-date" title="2015-11-15 23:14:54">2015/11/15</span>
        </a>
        
        <a  class="All 自动化 ansible "
           href="/posts/25732c33/"
           data-tag="ansible,lookup"
           data-author="" >
            <span class="post-title" title="ansible☞playbook-lookup插件">ansible☞playbook-lookup插件</span>
            <span class="post-date" title="1970-01-01 08:00:00">1970/01/01</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-k8s☞02v1.18.6安装" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">k8s☞02v1.18.6安装</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="容器">容器</a> > 
            
            <a  data-rel="容器&lt;---&gt;k8s">k8s</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color3">容器</a>
            
            <a class="color4">k8s</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2020-08-25 17:17:44'>2020-08-25 17:17</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:3.8k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views 👀 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                Comment:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%BA%E5%99%A8"><span class="toc-text">机器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%E5%9C%A8%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E4%B8%8A%E8%BF%90%E8%A1%8C"><span class="toc-text">以下命令在所有节点上运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#master%E8%8A%82%E7%82%B9"><span class="toc-text">master节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8%E7%8E%AF%E5%A2%83%EF%BC%88k8s01%EF%BC%8Ck8s02%EF%BC%8Ck8s03%EF%BC%89"><span class="toc-text">安装高可用环境（k8s01，k8s02，k8s03）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%89%E5%8F%96%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%EF%BC%88k8s01%EF%BC%8Ck8s02%EF%BC%8Ck8s03%EF%BC%89"><span class="toc-text">拉取容器镜像（k8s01，k8s02，k8s03）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85%EF%BC%88k8s01%EF%BC%89"><span class="toc-text">初始化安装（k8s01）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%9B%86%E7%BE%A4%E5%8A%A0%E5%85%A5%E5%91%BD%E4%BB%A4%EF%BC%88k8s01%EF%BC%89"><span class="toc-text">获取集群加入命令（k8s01）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#k8s02%E5%92%8Ck8s03%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%9B%86%E7%BE%A4"><span class="toc-text">k8s02和k8s03添加到集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#worker%E8%8A%82%E7%82%B9"><span class="toc-text">worker节点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9"><span class="toc-text">其他内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E4%B8%AD%E6%98%BE%E7%A4%BA%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%8F%AF%E8%A7%81%E8%B5%84%E6%BA%90"><span class="toc-text">容器中显示正确的可见资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7%E6%9C%8D%E5%8A%A1"><span class="toc-text">集群指标监控服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kubectl-%E5%91%BD%E4%BB%A4%E6%96%87%E6%A1%A3"><span class="toc-text">kubectl 命令文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%8E%E6%B8%85%E7%90%86"><span class="toc-text">删除与清理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E4%B8%80%E8%87%B4%E6%80%A7%E6%B5%8B%E8%AF%95"><span class="toc-text">节点一致性测试</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言">前言</h2>
<p>本文编写的时候，官方已经到了1.18.8，但是鉴于国内环境，非官方源没找到1.18.8，所以最后用的1.18.6<br>
另外，文中出现的宿主机ip，请自行修改为自己的环境ip</p>
<h2 id="机器">机器</h2>
<p>机器系统都是 centos7,</p>
<p>三个节点，均为主节点，同时也是工作节点，并利用 keepalived + haproxy 进行高可用</p>
<table>
<thead>
<tr>
<th>hostname</th>
<th>ip</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td>k8sapi</td>
<td>10.200.16.100</td>
<td>vip</td>
</tr>
<tr>
<td>k8s01</td>
<td>10.200.16.101</td>
<td>master</td>
</tr>
<tr>
<td>k8s02</td>
<td>10.200.16.102</td>
<td>master backup</td>
</tr>
<tr>
<td>k8s03</td>
<td>10.200.16.103</td>
<td>master backup</td>
</tr>
</tbody>
</table>
<p>请务必确保内网可以通过表格里的 <code>hostname</code> 解析到对应的 <code>ip</code></p>
<p>请务必将系统的 hostname 改为上述表里的 hostname</p>
<h2 id="以下命令在所有节点上运行">以下命令在所有节点上运行</h2>
<ol>
<li>
<p>时间同步</p>
<pre><code class="language-bash">yum install chrony -y
sed -i  '1a server cn.pool.ntp.org prefer iburst' /etc/chrony.conf
systemctl restart chronyd
systemctl enable chronyd
chronyc activity
</code></pre>
</li>
<li>
<p>系统配置</p>
<pre><code class="language-bash"># 加载模块
modprobe overlay
modprobe br_netfilter
# 添加配置
cat &gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt;EOF
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF
# 配置生效
sysctl --system

# 清空防火墙
systemctl stop firewalld.service iptables.service
systemctl disable firewalld.service
systemctl disable iptables.service;
iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X

# 关闭selinux
setenforce 0
sed -i 's@^\(SELINUX=\).*@\1disabled@' /etc/sysconfig/selinux
sed -i 's@^\(SELINUX=\).*@\1disabled@' /etc/selinux/config

# 关闭 swap，kubelet 1.18 要求.如果你fstab也有，请一并注释
swapoff -a

# 安装 ipvs
yum install ipvsadm -y
ipvsadm --clear
cat&gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt; 'EOF'
ipvs_mods_dir=&quot;/usr/lib/modules/$(uname -r)/kernel/net/netfilter/ipvs&quot;
for i in $(ls $ipvs_mods_dir | grep -o &quot;^[^.]*&quot;); do
    /sbin/modinfo -F filename $i  &amp;&gt; /dev/null
    if [ $? -eq 0 ]; then
        /sbin/modprobe $i
    fi
done
EOF
chmod +x /etc/sysconfig/modules/ipvs.modules
/etc/sysconfig/modules/ipvs.modules
</code></pre>
</li>
<li>
<p>安装 docker</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker">https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker</a></p>
</blockquote>
<pre><code class="language-bash">yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2
yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
yum list docker-ce --showduplicates | sort -r
# 安装兼容k8s的docker版本
yum install -y \
  containerd.io-1.2.13 \
  docker-ce-19.03.11 \
  docker-ce-cli-19.03.11
#sed -i '/ExecStart=/a ExecStartPort=/usr/sbin/iptables -P FORWARD ACCEPT' /usr/lib/systemd/system/docker.service;
mkdir -p /etc/docker;
cat &gt; /etc/docker/daemon.json &lt;&lt;EOF
&#123;
  &quot;data-root&quot;: &quot;/export/docker-data-root&quot;,
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],
  &quot;log-driver&quot;: &quot;json-file&quot;,
  &quot;log-opts&quot;: &#123;
    &quot;max-size&quot;: &quot;100m&quot;
  &#125;,
  &quot;storage-driver&quot;: &quot;overlay2&quot;,
  &quot;storage-opts&quot;: [
    &quot;overlay2.override_kernel_check=true&quot;
  ]
&#125;
EOF
mkdir -p /etc/systemd/system/docker.service.d
systemctl daemon-reload
systemctl restart docker
systemctl enable docker
</code></pre>
</li>
<li>
<p>安装 kubelet kubeadm kubectl</p>
<blockquote>
<p>阿里巴巴镜像点：</p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/kubernetes">https://developer.aliyun.com/mirror/kubernetes</a></p>
</blockquote>
</li>
</ol>
<blockquote>
<p>google 官方安装文档 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p>
</blockquote>
<pre><code class="language-bash">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF
# 确定 kube* 版本
yum list kube* --showduplicates --disableexcludes=kubernetes
# 选择要安装的版本
Version=1.18.6
# 安装 kube 管理组件和 kubelet
yum install -y kubelet-$&#123;Version&#125; kubeadm-$&#123;Version&#125; kubectl-$&#123;Version&#125; --disableexcludes=kubernetes
systemctl enable --now kubelet
</code></pre>
<blockquote>
<p>kubelet 1.18 的时候，当你使用 docker 的时候，kubeadm 会通过 kubelet 自动设置 cgroup 和 docker 一致。</p>
</blockquote>
<h2 id="master节点">master节点</h2>
<h3 id="安装高可用环境（k8s01，k8s02，k8s03）">安装高可用环境（k8s01，k8s02，k8s03）</h3>
<ul>
<li>安装haproxy和keepalived</li>
</ul>
<pre><code class="language-bash">yum install haproxy keepalived -y
</code></pre>
<ul>
<li>haproxy配置</li>
</ul>
<pre><code class="language-bash">cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.default
vim /etc/haproxy/haproxy.cfg
===
global
    log /dev/log local0
    log /dev/log local1 notice
    daemon

defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 1
    timeout http-request    10s
    timeout queue           20s
    timeout connect         5s
    timeout client          20s
    timeout server          20s
    timeout http-keep-alive 10s
    timeout check           10s

frontend apiserver
    bind *:8443
    mode tcp
    option tcplog
    default_backend apiserver

backend apiserver
    option httpchk GET /healthz
    http-check expect status 200
    mode tcp
    option ssl-hello-chk
    balance     roundrobin
        server k8sapivip 10.200.16.101:6443 check
        server k8sapivip 10.200.16.102:6443 check
        server k8sapivip 10.200.16.103:6443 check
</code></pre>
<ul>
<li>keepalived配置A （这个配置在三个master节点不一样）</li>
</ul>
<pre><code class="language-bash">cp /etc/keepalived/keepalived.conf  /etc/keepalived/keepalived.conf.default
vim /etc/keepalived/keepalived.conf
===
global_defs &#123;
    router_id LVS_DEVEL
&#125;
vrrp_script check_apiserver &#123;
  script &quot;/etc/keepalived/check_apiserver.sh&quot;
  interval 3
  weight -2
  fall 10
  rise 2
&#125;

vrrp_instance VI_1 &#123;
    state MASTER  # 改我改我：一个MASTER，两个BACKUP
    interface ens192  # 物理网卡名
    virtual_router_id 51
    priority 101  # 改我改我：MASTER 101，两个BACKUP 100
    authentication &#123;
        auth_type PASS
        auth_pass 42
    &#125;
    virtual_ipaddress &#123;
        10.200.16.100
    &#125;
    track_script &#123;
        check_apiserver
    &#125;
&#125;
</code></pre>
<ul>
<li>keepalived配置B：检测脚本</li>
</ul>
<pre><code class="language-bash">vim /etc/keepalived/check_apiserver.sh
===
#!/bin/sh

errorExit() &#123;
    echo &quot;*** $*&quot; 1&gt;&amp;2
    exit 1
&#125;

APISERVER_VIP=10.200.16.100
APISERVER_DEST_PORT=6443
curl --silent --max-time 2 --insecure https://localhost:$&#123;APISERVER_DEST_PORT&#125;/ -o /dev/null || errorExit &quot;Error GET https://localhost:$&#123;APISERVER_DEST_PORT&#125;/&quot;
if ip addr | grep -q $&#123;APISERVER_VIP&#125;; then
    curl --silent --max-time 2 --insecure https://$&#123;APISERVER_VIP&#125;:$&#123;APISERVER_DEST_PORT&#125;/ -o /dev/null || errorExit &quot;Error GET https://$&#123;APISERVER_VIP&#125;:$&#123;APISERVER_DEST_PORT&#125;/&quot;
fi

chmod a+x /etc/keepalived/check_apiserver.sh
</code></pre>
<ul>
<li>启动keepalived和haproxy</li>
</ul>
<pre><code class="language-bash">systemctl start keepalived haproxy
systemctl enable keepalived haproxy
</code></pre>
<h3 id="拉取容器镜像（k8s01，k8s02，k8s03）">拉取容器镜像（k8s01，k8s02，k8s03）</h3>
<blockquote>
<p>鉴于网络问题，所以国内一般无法直接运行初始化命令，因此最好先自行安装好包</p>
</blockquote>
<pre><code class="language-bash"># 查看对应版本 k8s 所需包
kubeadm config images list --kubernetes-version=$&#123;Version&#125;
# 运行下列脚本安装所需的包
# ---------------------我是脚本开头--------------------
#!/bin/bash
# kubeadm config images list
images=(
kube-apiserver:v$&#123;Version&#125;
kube-controller-manager:v$&#123;Version&#125;
kube-scheduler:v$&#123;Version&#125;
kube-proxy:v$&#123;Version&#125;
pause:3.2
etcd:3.4.3-0
coredns:1.6.7
)
for imageName in $&#123;images[@]&#125;;
do
    docker pull registry.aliyuncs.com/google_containers/$&#123;imageName&#125;
    docker tag registry.aliyuncs.com/google_containers/$&#123;imageName&#125; k8s.gcr.io/$&#123;imageName&#125;
    docker rmi registry.aliyuncs.com/google_containers/$&#123;imageName&#125;
done

# ---------------------我是脚本结尾--------------------
# 如果某些包无法下载，则需自行去 dockerhub 上找，并在下载完毕后，添加 k8s 自己的 tags，例如 coredns
# docker pull coredns/coredns:1.6.7 
# docker tag coredns/coredns:1.6.7 k8s.gcr.io/coredns:1.6.7
# docker rmi coredns/coredns:1.6.7
</code></pre>
<h3 id="初始化安装（k8s01）">初始化安装（k8s01）</h3>
<p>(info: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/%EF%BC%89">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/）</a></p>
<p>采取配置文件安装模式</p>
<pre><code class="language-bash">kubeadm config print init-defaults &gt; kubeadm.yaml.default
cat &gt; kubeadm.yaml &lt;&lt; EOF
# kubeadm.yaml 将默认的配置进行修改
apiVersion: kubeadm.k8s.io/v1beta2
bootstrapTokens:
- groups:
  - system:bootstrappers:kubeadm:default-node-token
  token: abcdef.8272827282sksksu   # 改我，改成你自己随意的字符串
  ttl: 24h0m0s
  usages:
  - signing
  - authentication
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: 10.200.16.101  # 改我，改成配置所在节点的物理ip
  bindPort: 6443
nodeRegistration:
  criSocket: /var/run/dockershim.sock
  name: k8s01 # 改我，理论上它会自动获取配置所在节点的 hostname
  taints:
  - effect: NoSchedule
    key: node-role.kubernetes.io/master
---
apiServer:
  timeoutForControlPlane: 4m0s
apiVersion: kubeadm.k8s.io/v1beta2
certificatesDir: /etc/kubernetes/pki
clusterName: kubernetes
controllerManager: &#123;&#125;
controlPlaneEndpoint: &quot;k8sapi:8443&quot; # 新加我
dns:
  type: CoreDNS
etcd:
  local:
    dataDir: /var/lib/etcd
imageRepository: k8s.gcr.io
kind: ClusterConfiguration
kubernetesVersion: v1.19.3 # 改我，改成你所需安装的版本
networking:
  dnsDomain: cluster.local
  serviceSubnet: 10.96.0.0/16 # 改我，定义 svc 的网段
  podSubnet: 10.97.0.0/16 # 改我，定义 pod 的网段
scheduler: &#123;&#125;
--- # 新加我
apiVersion: kubeproxy.config.k8s.io/v1alpha1 # 新加我
kind: KubeProxyConfiguration # 新加我
mode: ipvs  # 新加我
EOF

# 进行初始化
kubeadm init --config kubeadm.yaml
# 记录初始化生成的命令，特别是 kubeadm join
</code></pre>
<p>配置通过kubectl访问集群</p>
<pre><code class="language-bash">mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
# kubectl 命令补全
source &lt;(kubectl completion bash)

# You should now deploy a pod network to the cluster.
# Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
# https://kubernetes.io/docs/concepts/cluster-administration/addons/
</code></pre>
<pre><code class="language-bash"># 添加用户上下文到配置里，方便切换用户
kubectl config set-context admin --cluster=kubernetes --user=kubernetes-admin
</code></pre>
<p>调整 kube-controller-manager 和 scheduler 的配置.</p>
<pre><code class="language-bash"># 检查状态
kubectl get cs
# 你可能会发现,出现服务连接拒绝问题
controller-manager   Unhealthy   Get http://127.0.0.1:10252/healthz: dial tcp 127.0.0.1:10252: connect: connection refused
scheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: connect: connection refused
# 原因是这两个服务配置默认端口是0。至于为啥就不晓得了
# 你需要注释掉两个配置里的端口（- --port=0），恢复为默认端口
sed -i '/- --port=0/d' /etc/kubernetes/manifests/kube-scheduler.yaml
sed -i '/- --port=0/d' /etc/kubernetes/manifests/kube-controller-manager.yaml
# 重启 kubelet
systemctl restart kubelet
# 再次检查
kubectl get cs
===
NAME                 STATUS    MESSAGE             ERROR
scheduler            Healthy   ok
controller-manager   Healthy   ok
etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;
</code></pre>
<p>配置网络插件，网络插件常用的有两种，</p>
<p>第一种是 flannel，涉及到更多的 iptables 规则</p>
<p>第二种是 calico，涉及到更多的路由规则</p>
<ul>
<li>flannel (本文档选用的插件)</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/coreos/flannel">https://github.com/coreos/flannel</a> 代码托管地址</p>
</blockquote>
<pre><code class="language-bash">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
# 修改里面的 &quot;Network&quot;: &quot;10.244.0.0/16&quot;, 变更为你自己的 pod 网段，即kubeadm初始化阶段的 --pod-network-cidr
kubectl apply -f  kube-flannel.yml
</code></pre>
<ul>
<li>calico</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.projectcalico.org/getting-started/kubernetes/quickstart">https://docs.projectcalico.org/getting-started/kubernetes/quickstart</a> 安装文档</p>
</blockquote>
<pre><code class="language-bash">kubectl apply -f https://docs.projectcalico.org/manifests/tigera-operator.yaml
wget https://docs.projectcalico.org/manifests/custom-resources.yaml
# custom-resources.yaml 修改里面的网络为 pod 网段
kubectl apply -f custom-resources.yaml
</code></pre>
<blockquote>
<p>注意，当你使用了 calico 后， 会生成一些 cni 的配置，这些配置会导致你返回 flannel 的时候出现问题。例如无法创建 cni</p>
<p>你可以使用 find / -name ‘*calico*’ 找到所有信息，然后都删除</p>
</blockquote>
<p>默认kubeadm安装完后，禁止调度pod到master上。你可以通过下面的命令，关闭所有master节点的禁止调度</p>
<pre><code class="language-bash"> kubectl taint nodes --all node-role.kubernetes.io/master-
</code></pre>
<p>配置web控制台</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard">https://github.com/kubernetes/dashboard</a> 代码托管地址</p>
</blockquote>
<pre><code class="language-bash">wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml &amp;&amp; mv recommended.yaml kubernetes-dashboard.yaml
# 这里我们要修改一些东西
# 默认控制台的 svc 配置类型不是 NodePort，这会导致我们无法直接通过宿主机ip访问，这里我们为了方便，将 dashboard 的 svc 加入NodePort类型
#---
spec:
  ports:
    - port: 443
      targetPort: 8443
      nodePort: 30001
  type: NodePort
#---
# 还需要修改一下部署的位置，如果你集群中已经加入了多个节点，则会导致 pod 分发到其它节点上。这里我们强制分发到 master 上. 找到 kind: Deployment 配置，并修改两个 pod 的分发位置为 nodeName: &lt;master 节点主机名&gt;
#---
    spec:
      nodeName: k8s00
      containers:
        - name: kubernetes-dashboard
          image: kubernetesui/dashboard:v2.0.3
          
    spec:
      nodeName: k8s00
      containers:
        - name: dashboard-metrics-scraper
          image: kubernetesui/metrics-scraper:v1.0.4          
#---
# 然后创建
kubectl create -f kubernetes-dashboard.yaml

# 添加访问 token
# 官方文档： https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md
# 通过下面内容创建 kube-db-auth.yaml
cat &gt; kube-db-auth.yaml &lt;&lt; EOF
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kubernetes-dashboard
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard
EOF
kubectl apply -f kube-db-auth.yaml

# 通过下面命令拿到 token
kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '&#123;print $1&#125;')  

# 通过 https://&lt;masterip&gt;:30001 访问
</code></pre>
<h3 id="获取集群加入命令（k8s01）">获取集群加入命令（k8s01）</h3>
<pre><code class="language-bash"># 命令格式
kubeadm join xxx:8443 \
--token xxx \
--discovery-token-ca-cert-hash xxx \
--control-plane --certificate-key xxx
</code></pre>
<p>找回命令</p>
<pre><code class="language-bash"># 找回 token
kubeadm token list
# 找回 discovery-token-ca-cert-hash
openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'
</code></pre>
<p>命令重建</p>
<pre><code class="language-bash"># 创建新的 token 并输出 join 命令
kubeadm token create --print-join-command
===
kubeadm join k8sapi:8443 --token h77qhb.cjj8ig4t2v15dncm     --discovery-token-ca-cert-hash sha256:b7138bb76d19d3d7baf832e46559c400f4fe544d8f0ee81a87f
# 创建新的 --certificate-key
kubeadm init phase upload-certs --upload-certs
===
fd996c7c0c2047c9c10a377f25a332bf4b5b00ca
</code></pre>
<h3 id="k8s02和k8s03添加到集群">k8s02和k8s03添加到集群</h3>
<pre><code class="language-bash">kubeadm join k8sapi:8443 \
--token h77qhb.cjj8ig4t2v15dncm \
--discovery-token-ca-cert-hash sha256:b7138bb76d19d3d7baf832e46559c400f4fe544d8f0ee81a87f \
--control-plane --certificate-key fd996c7c0c2047c9c10a377f25a332bf4b5b00ca

# 根据提示，执行相关命令，一般都是下面的命令
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<p>如果etcd中曾经有k8s02和k8s03的节点信息，则你需要先从etcd中删除，否则加入的时候，会卡在检测etcd处，并最终报错.</p>
<p>删除etcd信息方式：</p>
<pre><code class="language-bash"># 输出 etcd 节点 id
ETCD=`docker ps|grep etcd|grep -v POD|awk '&#123;print $1&#125;'`
docker exec \
  -it $&#123;ETCD&#125; \
  etcdctl \
  --endpoints https://127.0.0.1:2379 \
  --cacert /etc/kubernetes/pki/etcd/ca.crt \
  --cert /etc/kubernetes/pki/etcd/peer.crt \
  --key /etc/kubernetes/pki/etcd/peer.key \
  member list
===
2f401672c9a538f1, started, k8s01, https://10.200.16.101:2380, https://10.200.16.101:2379, false
d6d9ca2a70f6638e, started, k8s02, https://10.200.16.102:2380, https://10.200.16.102:2379, false
ee0e9340a5cfb4d7, started, k8s03, https://10.200.16.103:2380, https://10.200.16.103:2379, false

# 假设这里我要删除 k8s03
ETCD=`docker ps|grep etcd|grep -v POD|awk '&#123;print $1&#125;'`
docker exec \
  -it $&#123;ETCD&#125; \
  etcdctl \
  --endpoints https://127.0.0.1:2379 \
  --cacert /etc/kubernetes/pki/etcd/ca.crt \
  --cert /etc/kubernetes/pki/etcd/peer.crt \
  --key /etc/kubernetes/pki/etcd/peer.key \
  member remove ee0e9340a5cfb4d7
</code></pre>
<h2 id="worker节点">worker节点</h2>
<blockquote>
<p>加入命令，位于 k8s01初始化命令尾部，worker加入的时候，不需要添加 --control-plane --certificate-key</p>
</blockquote>
<pre><code class="language-bash">kubeadm join k8sapi:8443 \
--token h77qhb.cjj8ig4t2v15dncm \
--discovery-token-ca-cert-hash sha256:b7138bb76d19d3d7baf832e46559c400f4fe544d8f0ee81a87f
</code></pre>
<h2 id="其他内容">其他内容</h2>
<h3 id="容器中显示正确的可见资源">容器中显示正确的可见资源</h3>
<p>默认情况下,不管你如何设置资源限制,容器里的可见资源都等于节点资源.也就是说你在容器里查看/proc/meminfo显示的资源并不是你设置的.这个问题会带来很多麻烦.</p>
<p>因为很多程序的参数都是根据可见资源来设定的.例如nginx的auto, 或者jvm里的内存参数.</p>
<blockquote>
<p>从 Java 8u191开始, jvm 已经默认实现了容器感知( -XX:+UseContainerSupport). 因此无需安装下面的 lxcfs 方案.</p>
<p>并且, 在容器中建议只设置如下内存参数:</p>
<p>-XX:MaxRAMPercentage  最大堆内存=物理内存百分比, 建议为容器限制的50%-75% . 毕竟还需要预留其它内存.</p>
</blockquote>
<p>而社区常见的作法是用<code>lxcfs</code> 来提升资源的可见性.<code>lxcfs</code> 是一个开源的FUSE（用户态文件系统）实现来支持LXC容器, 它也可以支持Docker容器.</p>
<p>LXCFS通过用户态文件系统, 在容器中提供下列 <code>procfs</code> 的文件.</p>
<pre><code class="language-bash">/proc/cpuinfo
/proc/diskstats
/proc/meminfo
/proc/stat
/proc/swaps
/proc/uptime
</code></pre>
<p>与我们资源限制有关的, 主要是 cpuinfo 和 meminfo.</p>
<p>目前社区的做法如下:</p>
<ol>
<li>
<p>所有节点安装 fuse-libs 包.</p>
<pre><code class="language-bash">yum install -y fuse-libs
</code></pre>
</li>
<li>
<p>集群部署lxcfs deployment</p>
<pre><code class="language-bash">git clone https://github.com/denverdino/lxcfs-admission-webhook.git
cd lxcfs-admission-webhook
vim deployment/lxcfs-daemonset.yaml
=== 修正配置里的 apiVersion
=== 当前git里的代码是陈旧的...代码里的版本在 1.18 已经被废弃). 具体归属于什么版本, 请参考k8s官方api文档 
=== https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19/#daemonset-v1-apps
apiVersion:apps/v1  

kubectl apply -f deployment/lxcfs-daemonset.yaml
kubectl get pod
#等待 lxcfs pod 状态成 running
#如果你发现 pod 始终出错，那么执行下列命令：
kubectl delete -f deployment/lxcfs-daemonset.yaml
rm -rf /var/lib/lxcfs
kubectl apply -f deployment/lxcfs-daemonset.yaml

deployment/install.sh
kubectl get secrets,pods,svc,mutatingwebhookconfigurations
</code></pre>
</li>
<li>
<p>给相关namespace注入lxcfs，例如default</p>
<pre><code class="language-bash">kubectl label namespace default lxcfs-admission-webhook=enabled
</code></pre>
</li>
<li>
<p>重启添加了资源限制的pod, 此时 /proc/cpuinfo 和 /proc/meminfo 将会正确显示.</p>
</li>
</ol>
<h3 id="集群指标监控服务">集群指标监控服务</h3>
<p>添加 metrics-server  <a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/metrics-server#configuration">https://github.com/kubernetes-sigs/metrics-server#configuration</a></p>
<pre><code class="language-bash">helm show values stable/metrics-server &gt; metrics-server.yaml
# 修改配置添加额外的启动参数(arg)
args:
  - --kubelet-preferred-address-types=InternalIP
  - --kubelet-insecure-tls
helm install metrics-server stable/metrics-server -f metrics-server.yaml
kubectl get --raw &quot;/apis/metrics.k8s.io/v1beta1/nodes&quot;
</code></pre>
<blockquote>
<p>kubectl top 指令需要指标才能输出</p>
</blockquote>
<hr>
<h2 id="kubectl-命令文档">kubectl 命令文档</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a></p>
</blockquote>
<pre><code class="language-bash"># 查询集群网络的app
kubectl run -it --rm --restart=Never --image=infoblox/dnstools:latest dnstools
</code></pre>
<h2 id="删除与清理">删除与清理</h2>
<pre><code class="language-bash"># 从集群里删除某个节点
# master exec
kubectl drain &lt;NODE_ID&gt; --delete-local-data --force --ignore-daemonsets
kubectl delete node &lt;NODE_ID&gt;
# worker exec
kubeadm reset
iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X
ipvsadm --clear;
ip link set cni0 down &amp;&amp; ip link delete cni0;
ip link set flannel.1 down &amp;&amp; ip link delete flannel.1;
ip link set kube-ipvs0 down &amp;&amp; ip link delete kube-ipvs0;
ip link set dummy0 down &amp;&amp; ip link delete dummy0;
rm -rf /var/lib/cni/
rm -rf $HOME/.kube;
</code></pre>
<h2 id="节点一致性测试">节点一致性测试</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/node-conformance/">https://kubernetes.io/docs/setup/node-conformance/</a></p>
</blockquote>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 aaa103439@hotmail.com </span>
    </div>
</article>





    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '5d6fb59b1508af7318d7',
            clientSecret: 'bca058cc7e0b4b62ce5d43b046bb18d9484e5163',
            proxy: 'https://zyh-cool.gitalk.workers.dev/https://github.com/login/oauth/access_token',
            repo: 'zyh.github.io',
            owner: 'Spinestars',
            admin: ['Spinestars'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2016-2020 zyh.cool
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
